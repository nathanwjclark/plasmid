{"version":3,"sources":["index.js"],"names":["mod","n","m","initBase","getFullDefault","usePersistentCanvas","useState","locations","setLocations","canvasRef","React","useRef","useEffect","canvas","current","width","offsetWidth","height","offsetHeight","ctx","getContext","clearRect","window","innerWidth","innerHeight","radius","circle","origX","origin","x","origY","y","strokeColor","beginPath","arc","Math","PI","lineWidth","strokeStyle","stroke","drawCircleGuide","length","bases","lastend","toggle","i","features","feat","includes","type","start","startRotation","endRotation","end","lower","pow","zoom","zoomLevel","upper","leftCos","cos","leftSin","sin","lowerLeft","upperLeft","arrowFrac","abs","rightCos","rightSin","lowerRight","midRight","upperRight","fillStyle","random_rgb","moveTo","lineTo","fill","drawFeatureLabels","name","drawFeatures","font","textAlign","locx","locy","fillText","seqName","para","purpose","split","yadjust","text","concat","drawCenter","maxAnnots","floor","circumferenceBases","inflectRadius","endRadius","triedLocs","startLoc","circleSeq","circleLoc","j","triedLoc","startX","startY","inflectX","inflectY","endX","endY","textX","textHeightMargin","textY","rendertext","slice","drawAnnotations","scenario","pointer","selection","drawPointer","activated","drawSelector","drawImage","image","poly","drawPoly","drawPlasmid","drawMaster","seed","lightener","color","prng","h","s","l","r","g","b","hue2rgb","p","q","t","toHex","hex","round","toString","hslToHex","radiusSizer","min","loadPlasmidFile","file","fileToParse","allText","rawFile","XMLHttpRequest","open","onreadystatechange","readyState","status","responseText","send","readTextFile","genbankParser","updatePlasmid","root","plasmid","newString","sequence","toUpperCase","newBases","number","loc","getCircleLocation","addedBase","letter","random","vx","vy","weight","baseString","keywords","definition","link","annotations","getDefaultAnnotations","newCircle","base_image","Image","src","endmax","mousex","mousey","isZooming","zoomDirection","zoomCenter","target","locus","endBase","startBase","fontheight","max","center","spacing","startAngle","rotation","translate","rotate","resetTransform","transparency","inversion","base","fillColor","baseForceFromCircle","newBase","sign","baseNumber","basesLength","increment","zoomCircle","trigger","startenddiff","maxBasesOnZoom","zoomedMax","zoomBroker","factor","startRadius","windowContext","adder","radiff","brokerMouseDrag","event","direction","temp","tickPlasmid","radialstart","radialend","lowerlimit","upperlimit","diffx","diffy","runPoly","ReactDOM","render","timerID","setInterval","clearInterval","onresize","ref","style","border","onClick","e","onMouseMove","mouse","clientX","clientY","ydiff","xdiff","angle","sqrt","atan2","runPointer","onMouseDown","onMouseUp","display","id","document","getElementsByClassName","classList","className","onChange","value","for","href","placeholder","console","log","getElementById"],"mappings":"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","file":"static/js/main.ee5cb25c.chunk.js","sourcesContent":["import ReactDOM from 'react-dom';\nimport React, { useState, createContext, useMemo, useCallback, useEffect } from 'react';\nimport './App.css'\nimport * as genbankParser from 'genbank-parser'\n\n// DECLARATION SECTION ======================================================================\nfunction mod(n, m) {\n  return ((n % m) + m) % m;\n}\n\nfunction usePersistentState() {\n  const [value, setValue] = React.useState(\n    //JSON.parse(localStorage.getItem('draw-app')) || init\n  )\n\n  React.useEffect(() => {\n    localStorage.setItem('draw-app', JSON.stringify(value))\n  })\n\n  return [value, setValue]\n}\n\nconst initBase = getFullDefault()\n\nfunction usePersistentCanvas() {\n  const [locations, setLocations] = useState(initBase);\n\n  const canvasRef = React.useRef(null)\n\n  React.useEffect(() => {\n    const canvas = canvasRef.current\n    canvas.width = canvas.offsetWidth;\n    canvas.height = canvas.offsetHeight;\n    const ctx = canvas.getContext('2d')\n    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight)\n\n    drawMaster(ctx, locations)\n  })\n\n  return [locations, setLocations, canvasRef]\n}\n\nfunction init(){\n    var base_image = '';\n    //base_image.src = \"https://upload.wikimedia.org/wikipedia/commons/7/7d/Eukaryotic_RNA-polymerase_II_structure_1WCM.png\";\n    return {\n        scenario: 'fullPlasmid',\n        //scenario: fullPlasmid, arc, poly, zoom\n\n        circle:\n            {radius: radiusSizer(), origin:\n                {x:window.innerWidth*0.6, y:window.innerHeight/2}\n            },\n        //arc,\n        seqName: '',\n        link:'',\n        purpose: '',\n        bases:[],\n        baseString: '',\n        annotations:[],\n        features:[],\n        selection: {\n            pointer: null,\n            start: 0,\n            end: 0,\n            endmax: 0,\n            activated: false,\n            mousex: null,\n            mousey: null\n        },\n        zoom: {\n            zoomLevel: 1,\n            isZooming: 0,\n            zoomDirection: -1,\n            zoomCenter: 0\n        },\n        poly: {\n            x: 100,\n            y: 100,\n            target: -1\n        },\n        image: base_image\n    }\n}\n\nfunction readTextFile(file)\n{\n    var rawFile = new XMLHttpRequest();\n    var allText;\n    rawFile.open(\"GET\", file, false);\n    rawFile.onreadystatechange = function ()\n    {\n        if(rawFile.readyState === 4)\n        {\n            if(rawFile.status === 200 || rawFile.status == 0)\n            {\n                allText = rawFile.responseText;\n            }\n        }\n    }\n    rawFile.send(null);\n    return allText;\n}\n\nfunction prng(seed) {\n    var x = Math.sin(seed++) * 10000;\n    return x - Math.floor(x);\n}\n\nfunction hslToHex(h, s, l) {\n  h /= 360;\n  s /= 100;\n  l /= 100;\n  let r, g, b;\n  if (s === 0) {\n    r = g = b = l; // achromatic\n  } else {\n    const hue2rgb = (p, q, t) => {\n      if (t < 0) t += 1;\n      if (t > 1) t -= 1;\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\n      if (t < 1 / 2) return q;\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n      return p;\n    };\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n    const p = 2 * l - q;\n    r = hue2rgb(p, q, h + 1 / 3);\n    g = hue2rgb(p, q, h);\n    b = hue2rgb(p, q, h - 1 / 3);\n  }\n  const toHex = x => {\n    const hex = Math.round(x * 255).toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  };\n  return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\n}\n\nfunction random_rgb(seed, lightener) {\n    var color = prng(seed)\n    var hslbaseashex = hslToHex(360 * color,\n             75,\n             (85 + 10 * color) * lightener)\n    return hslbaseashex;\n}\n\nfunction radiusSizer(){\n    return Math.min(window.innerWidth/4,window.innerHeight/2.75)\n}\n\n// LOGICAL HELPERS ===============================================================================\n\nfunction loadFullChange(){\n\n}\n\nfunction loadPartialBaseChange(){\n\n}\n\nfunction stringToBases(baseString){\n\n    var temp = []\n\n    for (var i =0; i < baseString.length; i++) {\n        var base = {\n            base: baseString[i],\n            x: 100,\n            y: 100,\n            vx: 0,\n            vy: 0,\n            weight: 1\n        }\n        temp = [...temp,base]\n    }\n\n    return temp\n}\n\nfunction getDefaultBases() {\n    return 'ACCTGCGGGCCGTCTAAAAATTAAGGAAAAGCAGCAAAGGTGCATTTTTAAAATATGAAA\\n' +\n    'TGAAGATACCGCAGTACCAATTATTTTCGCAGTACAAATAATGCGCGGCCGGTGCATTTT\\n' +\n    'TCGAAAGAACGCGAGACAAACAGGACAATTAAAGTTAGTTTTTCGAGTTAGCGTGTTTGA\\n' +\n    'ATACTGCAAGATACAAGATAAATAGAGTAGTTGAAACTAGATATCAATTGCACACAAGAT\\n' +\n    'CGGCGCTAAGCATGCCACAATTTGGTATATTATGTAAAACACCACCTAAGGTGCTTGTTC\\n' +\n    'GTCAGTTTGTGGAAAGGTTTGAAAGACCTTCAGGTGAGAAAATAGCATTATGTGCTGCTG\\n' +\n    'AACTAACCTATTTATGTTGGATGATTACACATAACGGAACAGCAATCAAGAGAGCCACAT\\n' +\n    'TCATGAGCTATAATACTATCATAAGCAATTCGCTGAGTTTCGATATTGTCAATAAATCAC\\n' +\n    'TCCAGTTTAAATACAAGACGCAAAAAGCAACAATTCTGGAAGCCTCATTAAAGAAATTGA\\n' +\n    'TTCCTGCTTGGGAATTTACAATTATTCCTTACTATGGACAAAAACATCAATCTGATATCA\\n' +\n    'CTGATATTGTAAGTAGTTTGCAATTACAGTTCGAATCATCGGAAGAAGCAGATAAGGGAA\\n' +\n    'ATAGCCACAGTAAAAAAATGCTTAAAGCACTTCTAAGTGAGGGTGAAAGCATCTGGGAGA\\n' +\n    'TCACTGAGAAAATACTAAATTCGTTTGAGTATACTTCGAGATTTACAAAAACAAAAACTT\\n' +\n    'TATACCAATTCCTCTTCCTAGCTACTTTCATCAATTGTGGAAGATTCAGCGATATTAAGA\\n' +\n    'ACGTTGATCCGAAATCATTTAAATTAGTCCAAAATAAGTATCTGGGAGTAATAATCCAGT\\n' +\n    'GTTTAGTGACAGAGACAAAGACAAGCGTTAGTAGGCACATATACTTCTTTAGCGCAAGGG\\n' +\n    'GTAGGATCGATCCACTTGTATATTTGGATGAATTTTTGAGGAATTCTGAACCAGTCCTAA\\n' +\n    'AACGAGTAAATAGGACCGGCAATTCTTCAAGCAATAAACAGGAATACCAATTATTAAAAG\\n' +\n    'ATAACTTAGTCAGATCGTACAATAAAGCTTTGAAGAAAAATGCGCCTTATTCAATCTTTG\\n' +\n    'CTATAAAAAATGGCCCAAAATCTCACATTGGAAGACATTTGATGACCTCATTTCTTTCAA\\n' +\n    'TGAAGGGCCTAACGGAGTTGACTAATGTTGTGGGAAATTGGAGCGATAAGCGTGCTTCTG\\n' +\n    'CCGTGGCCAGGACAACGTATACTCATCAGATAACAGCAATACCTGATCACTACTTCGCAC\\n' +\n    'TAGTTTCTCGGTACTATGCATATGATCCAATATCAAAGGAAATGATAGCATTGAAGGATG\\n' +\n    'AGACTAATCCAATTGAGGAGTGGCAGCATATAGAACAGCTAAAGGGTAGTGCTGAAGGAA\\n' +\n    'GCATACGATACCCCGCATGGAATGGGATAATATCACAGGAGGTACTAGACTACCTTTCAT\\n' +\n    'CCTACATAAATAGACGCATATAAGTACGCATTTAAGCATAAACACGCACTATGCCGTTCT\\n' +\n    'TCTCATGTATATATATATACAGGCAACACGCAGATATAGGTGCGACGTGAACAGTGAGCT\\n' +\n    'GTATGTGCGCAGCTCGCGTTGCATTTTCGGAAGCGCTCGTTTTCGGAAACGCTTTGAAGT\\n' +\n    'TCCTATTCCGAAGTTCCTATTCTCTAGAAAGTATAGGAACTTCAGAGCGCTTTTGAAAAC\\n' +\n    'CAAAAGCGCTCTGAAGACGCACTTTCAAAAAACCAAAAACGCACCGGACTGTAACGAGCT\\n' +\n    'ACTAAAATATTGCGAATACCGCTTCCACAAACATTGCTCAAAAGTATCTCTTTGCTATAT\\n' +\n    'ATCTCTGTGCTATATCCCTATATAACCTACCCATCCACCTTTCGCTCCTTGAACTTGCAT\\n' +\n    'CTAAACTCGACCTCTACATCAACAGGCTTCCAATGCTCTTCAAATTTTACTGTCAAGTAG\\n' +\n    'ACCCATACGGCTGTAATATGCTGCTCTTCATAATGTAAGCTTATCTTTATCGAATCGTGT\\n' +\n    'GAAAAACTACTACCGCGATAAACCTTTACGGTTCCCTGAGATTGAATTAGTTCCTTTAGT\\n' +\n    'ATATGATACAAGACACTTTTGAACTTTGTACGACGAATTTTGAGGTTCGCCATCCTCTGG\\n' +\n    'CTATTTCCAATTATCCTGTCGGCTATTATCTCCGCCTCAGTTTGATCTTCCGCTTCAGAC\\n' +\n    'TGCCATTTTTCACATAATGAATCTATTTCACCCCACAATCCTTCATCCGCCTCCGCATCT\\n' +\n    'TGTTCCGTTAAACTATTGACTTCATGTTGTACATTGTTTAGTTCACGAGAAGGGTCCTCT\\n' +\n    'TCAGGCGGTAGCTCCTGATCTCCTATATGACCTTTATCCTGTTCTCTTTCCACAAACTTA\\n' +\n    'GAAATGTATTCATGAATTATGGAGCACCTAATAACATTCTTCAAGGCGGAGAAGTTTGGG\\n' +\n    'CCAGATGCCCAATATGCTTGACATGAAAACGTGAGAATGAATTTAGTATTATTGTGATAT\\n' +\n    'TCTGAGGCAATTTTATTATAATCTCGAAGATAAGAGAAGAATGCAGTGACCTTTGTATTG\\n' +\n    'ACAAATGGAGATTCCATGTATCTAAAAAATACGCCTTTAGGCCTTCTGATACCCTTTCCC\\n' +\n    'CTGCGGTTTAGCGTGCCTTTTACATTAATATCTAAACCCTCTCCGATGGTGGCCTTTAAC\\n' +\n    'TGACTAATAAATGCAACCGATATAAACTGTGATAATTCTGGGTGATTTATGATTCGATCG\\n' +\n    'ACAATTGTATTGTACACTAGTGCAGGATCAGGCCAATCCAGTTCTTTTTCAATTACCGGT\\n' +\n    'GTGTCGTCTGTATTCAGTACATGTCCAACAAATGCAAATGCTAACGTTTTGTATTTCTTA\\n' +\n    'TAATTGTCAGGAACTGGAAAAGTCCCCCTTGTCGTCTCGATTACACACCTACTTTCATCG\\n' +\n    'TACACCATAGGTTGGAAGTGCTGCATAATACATTGCTTAATACAAGCAAGCAGTCTCTCG\\n' +\n    'CCATTCATATTTCAGTTATTTTCCATTACAGCTGATGTCATTGTATATCAGCGCTGTAAA\\n' +\n    'AATCTATCTGTTACAGAAGGTTTTCGCGGTTTTTATAAACAAAACTTTCGTTACGAAATC\\n' +\n    'GAGCAATCACCCCAGCTGCGTATTTGGAAATTCGGGAAAAAGTAGAGCAACGCGAGTTGC\\n' +\n    'ATTTTTTACACCATAATGCATGATTAACTTCGAGAAGGGATTAAGGCTAATTTCACTAGT\\n' +\n    'ATGTTTCAAAAACCTCAATCTGTCCATTGAATGCCTTATAAAACAGCTATAGATTGCATA\\n' +\n    'GAAGAGTTAGCTACTCAATGCTTTTTGTCAAAGCTTACTGATGATGATGTGTCTACTTTC\\n' +\n    'AGGCGGGTCTGTAGTAAGGAGAATGACATTATAAAGCTGGCACTTAGAATTCCACGGACT\\n' +\n    'ATAGACTATACTAGTATACTCCGTCTACTGTACGATACACTTCCGCTCAGGTCCTTGTCC\\n' +\n    'TTTAACGAGGCCTTACCACTCTTTTGTTACTCTATTGATCCAGCTCAGCAAAGGCAGTGT\\n' +\n    'GATCTAAGATTCTATCTTCGCGATGTAGTAAAACTAGCTAGACCGAGAAAGAGACTAGAA\\n' +\n    'ATGCAAAAGGCACTTCTACAATGGCTGCCATCATTATTATCCGATGTGACGCTGCAGCTT\\n' +\n    'CTCAATGATATTCGAATACGCTTTGAGGAGATACAGCCTAATATCCGACAAACTGTTTTA\\n' +\n    'CAGATTTACGATCGTACTTGTTACCCATCATTGAATTTTGAACATCCGAACCTGGGAGTT\\n' +\n    'TTCCCTGAAACAGATAGTATATTTGAACCTGTATAATAATATATAGTCTAGCGCTTTACG\\n' +\n    'GAAGACAATGTATGTATTTCGGTTCCTGGAGAAACTATTGCATCTATTGCATAGGTAATC\\n' +\n    'TTGCACGTCGCATCCCCGGTTCATTTTCTGCGTTTCCATCTTGCACTTCAATAGCATATC\\n' +\n    'TTTGTTAACGAAGCATCTGTGCTTCATTTTGTAGAACAAAAATGCAACGCGAGAGCGCTA\\n' +\n    'ATTTTTCAAACAAAGAATCTGAGCTGCATTTTTACAGAACAGAAATGCAACGCGAAAGCG\\n' +\n    'CTATTTTACCAACGAAGAATCTGTGCTTCATTTTTGTAAAACAAAAATGCAACGCGAGAG\\n' +\n    'CGCTAATTTTTCAAACAAAGAATCTGAGCTGCATTTTTACAGAACAGAAATGCAACGCGA\\n' +\n    'GAGCGCTATTTTACCAACAAAGAATCTATACTTCTTTTTTGTTCTACAAAAATGCATCCC\\n' +\n    'GAGAGCGCTATTTTTCTAACAAAGCATCTTAGATTACTTTTTTTCTCCTTTGTGCGCTCT\\n' +\n    'ATAATGCAGTCTCTTGATAACTTTTTGCACTGTAGGTCCGTTAAGGTTAGAAGAAGGCTA\\n' +\n    'CTTTGGTGTCTATTTTCTCTTCCATAAAAAAAGCCTGACTCCACTTCCCGCGTTTACTGA\\n' +\n    'TTACTAGCGAAGCTGCGGGTGCATTTTTTCAAGATAAAGGCATCCCCGATTATATTCTAT\\n' +\n    'ACCGATGTGGATTGCGCATACTTTGTGAACAGAAAGTGATAGCGTTGATGATTCTTCATT\\n' +\n    'GGTCAGAAAATTATGAACGGTTTCTTCTATTTTGTCTCTATATACTACGTATAGGAAATG\\n' +\n    'TTTACATTTTCGTATTGTTTTCGATTCACTCTATGAATAGTTCTTACTACAATTTTTTTG\\n' +\n    'TCTAAAGAGTAATACTAGAGATAAACATAAAAAATGTAGAGGTCGAGTTTAGATGCAAGT\\n' +\n    'TCAAGGAGCGAAAGGTGGATGGGTAGGTTATATAGGGATATAGCACAGAGATATATAGCA\\n' +\n    'AAGAGATACTTTTGAGCAATGTTTGTGGAAGCGGTATTCGCAATATTTTAGTAGCTCGTT\\n' +\n    'ACAGTCCGGTGCGTTTTTGGTTTTTTGAAAGTGCGTCTTCAGAGCGCTTTTGGTTTTCAA\\n' +\n    'AAGCGCTCTGAAGTTCCTATACTTTCTAGAGAATAGGAACTTCGGAATAGGAACTTCAAA\\n' +\n    'GCGTTTCCGAAAACGAGCGCTTCCGAAAATGCAACGCGAGCTGCGCACATACAGCTCACT\\n' +\n    'GTTCACGTCGCACCTATATCTGCGTGTTGCCTGTATATATATATACATGAGAAGAACGGC\\n' +\n    'ATAGTGCGTGTTTATGCTTAAATGCGTACTTATATGCGTCTATTTATGTAGGATGAAAGG\\n' +\n    'TAGTCTAGTACCTCCTGTGATATTATCCCATTCCATGCGGGGTATCGTATGCTTCCTTCA\\n' +\n    'GCACTACCCTTTAGCTGTTCTATATGCTGCCACTCCTCAATTGGATTAGTCTCATCCTTC\\n' +\n    'AATGCTATCATTTCCTTTGATATTGGATCATACCCTAGAAGTATTACGTGATTTTCTGCC\\n' +\n    'CCTTACCCTCGTTGCTACTCTCCTTTTTTTCGTGGGAACCGCTTTAGGGCCCTCAGTGAT\\n' +\n    'GGTGTTTTGTAATTTATATGCTCCTCTTGCATTTGTGTCTCTACTTCTTGTTCGCCTGGA\\n' +\n    'GGGAACTTCTTCATTTGTATTAGCATGGTTCACTTCAGTCCTTCCTTCCAACTCACTCTT\\n' +\n    'TTTTTGCTGTAAACGATTCTCTGCCGCCAGTTCATTGAAACTATTGAATATATCCTTTAG\\n' +\n    'AGATTCCGGGATGAATAAATCACCTATTAAAGCAGCTTGACGATCTGGTGGAACTAAAGT\\n' +\n    'AAGCAATTGGGTAACGACGCTTACGAGCTTCATAACATCTTCTTCCGTTGGAGCTGGTGG\\n' +\n    'GACTAATAACTGTGTACAATCCATTTTTCTCATGAGCATTTCGGTAGCTCTCTTCTTGTC\\n' +\n    'TTTCTCGGGCAATCTTCCTATTATTATAGCAATAGATTTGTATAGTTGCTTTCTATTGTC\\n' +\n    'TAACAGCTTGTTATTCTGTAGCATCAAATCTATGGCAGCCTGACTTGCTTCTTGTGAAGA\\n' +\n    'GAGCATACCATTTCCAATCGAATCAAACCTTTCCTTAACCATCTTCGCAGCAGGCAAAAT\\n' +\n    'TACCTCAGCACTGGAGTCAGAAGATACGCTGGAATCTTCTGCGCTAGAATCAAGACCATA\\n' +\n    'CGGCCTACCGGTTGTGAGAGATTCCATGGGCCTTATGACATATCCTGGAAAGAGTAGCTC\\n' +\n    'ATCAGACTTACGTTTACTCTCTATATCAATATCTACATCAGGAGCAATCATTTCAATAAA\\n' +\n    'CAGCCGACATACATCCCAGACGCTATAAGCTGTACGTGCTTTTACCGTCAGATTCTTGGC\\n' +\n    'TGTTTCAATGTCGTCCATTTTGGTTTTCTTTTACCAGTATTGTTCGTTTGATAATGTATT\\n' +\n    'CTTGCTTATTACATTATAAAATCTGTGCAGATCACATGTCAAAACAACTTTTTATCACAA\\n' +\n    'GATAGTACCGCAAAACGA'\n}\n\nfunction loadPlasmidFile(file){\n    var fileToParse = readTextFile(file)\n    var parsedFile = genbankParser(fileToParse)\n    return parsedFile[0]\n}\n\nfunction updatePlasmid(locations, file){\n    var root = locations\n    var plasmid = loadPlasmidFile(file)\n\n    var newString = plasmid.sequence.toUpperCase()\n\n    var newBases = []\n    for (var i=0; i < newString.length; i++) {\n        var number = i\n        var loc = getCircleLocation(number, newString.length, root.circle)\n        var addedBase = {\n            number: number,\n            letter: newString[i],\n            x: loc.x + (Math.random() - 0.5) * 100,\n            y: loc.y + (Math.random() - 0.5) * 100,\n            vx: 0,\n            vy: 0,\n            weight: 1\n        }\n        newBases = [...newBases, addedBase]\n    }\n\n    root = {...root,\n        bases: newBases,\n        baseString: newString,\n        seqName: plasmid.keywords,\n        purpose: plasmid.definition,\n        link: file,\n        features: plasmid.features,\n        annotations: getDefaultAnnotations()\n    }\n    return root\n}\n\nfunction getFullDefault() {\n    var root = loadPlasmidFile('https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/14/90/181490/addgene-plasmid-60957-sequence-181490.gbk')\n\n    var newCircle = {radius: radiusSizer(), origin:\n                {x:window.innerWidth*0.4, y:window.innerHeight/2}\n        }\n\n    var newString = root.sequence.toUpperCase()\n    var newBases = []\n    for (var i=0; i < newString.length; i++) {\n        var number = i\n        var loc = getCircleLocation(number, newString.length, newCircle)\n        var addedBase = {\n            number: number,\n            letter: newString[i],\n            x: loc.x + (Math.random() - 0.5) * 100,\n            y: loc.y + (Math.random() - 0.5) * 100,\n            vx: 0,\n            vy: 0,\n            weight: 1\n        }\n        newBases = [...newBases, addedBase]\n    }\n\n    var base_image = new Image();\n    base_image.src = \"https://upload.wikimedia.org/wikipedia/commons/7/7d/Eukaryotic_RNA-polymerase_II_structure_1WCM.png\";\n\n    var newLocations = {\n        scenario: 'fullPlasmid',\n        circle: newCircle,\n        seqName:root.keywords,\n        link: 'https://www.addgene.org/60957/',\n        purpose: root.definition,\n        bases:newBases,\n        baseString: newString,\n        annotations:getDefaultAnnotations(),\n        features:root.features,\n        selection: {\n            start: Math.PI * (-0.4),\n            end: Math.PI * (-0.6),\n            endmax: Math.PI * (-0.6),\n            activated: false,\n            mousex: null,\n            mousey: null\n        },\n        zoom: {\n            pointer: null,\n            zoomLevel: 1,\n            isZooming: 0,\n            zoomDirection: -1,\n            zoomCenter: 0\n        },\n        poly: {\n            x: 100,\n            y: 100,\n            target: -1\n        },\n        image: base_image\n    }\n\n    return newLocations\n}\n\nfunction getDefaultFeatures(){\n    var features = [\n        {\n            name: 'Cas9',\n            start: 0,\n            end: 2735,\n            color: '#e39bbf'\n        },\n        {\n            name: 'EcoR1',\n            start: 2736,\n            end: 4023,\n            color: '#87bbdc'\n        },\n        {\n            name: 'TANF',\n            start: 4324,\n            end: 4978,\n            color: '#f5c1a0'\n        }\n    ]\n    return features\n}\n\nfunction getDefaultAnnotations(){\n    var anns = [\n        {\n            name: 'Waldo',\n            locus: 1232\n        },\n        {\n            name: 'Wanda',\n            locus: 23\n        },\n        {\n            name: 'Aries',\n            locus: 24\n        }\n    ]\n    return anns\n}\n\nfunction updateBases(newString, oldString, oldBases, circle) {\n    // need to handle base insertion or deletion later on\n    var newBases = oldBases\n\n    for (var i=0; i < (newString.length - oldString.length); i++) {\n        var number = oldBases.length + i\n        var loc = getCircleLocation(number, newString.length, circle)\n        var addedBase = {\n            number: number,\n            letter: newString[oldBases.length + i],\n            x: loc.x + (Math.random() - 0.5) * 100,\n            y: loc.y + (Math.random() - 0.5) * 100,\n            vx: 0,\n            vy: 0,\n            weight: 1\n        }\n        newBases = [...newBases, addedBase]\n    }\n\n    return newBases\n}\n\n// DRAWING SECTION ======================================================================\n\nfunction drawMaster(ctx,locations) {\n\n    drawCircleGuide(ctx, locations)\n    drawFeatures(ctx, locations)\n    drawCenter(ctx, locations)\n    drawAnnotations(ctx, locations)\n\n    if (locations.scenario === 'fullPlasmid') {\n\n        drawPointer(ctx, locations)\n        if(locations.selection.activated == true){\n            drawSelector(ctx, locations)\n        }\n    } else if (locations.scenario === 'poly') {\n        drawPoly(ctx, locations)\n        drawPlasmid(ctx, locations)\n        // drawRNAPol(ctx,locations)\n        // drawMRNA(ctx,locations)\n        // drawRibosome(ctx,locations)\n        // drawAminos(ctx,locations)\n        // drawProtein(ctx,locations)\n    } else if (locations.scenario === 'arc') {\n        drawPlasmid(ctx, locations)\n        // drawArc(ctx,locations)\n        // drawArcBases(ctx,locations)\n    } else if (locations.scenario === 'zoom') {\n        drawPlasmid(ctx, locations)\n        // drawCircleGuide(ctx,locations)\n        // drawPlasmid(ctx,locations)\n        // drawArc(ctx,locations)\n        // drawArcBases(ctx,locations)\n    }\n}\n\nfunction drawSelector(ctx, locations) {\n    var start = locations.selection.start\n    var pointer = locations.selection.pointer\n\n    var baseMax = 1000\n    var max = Math.PI * 2 * baseMax / locations.bases.length\n\n    ctx.strokeStyle = 'rgba(95,154,220,0.75)'\n    //draw start\n    var upper = 1.2\n    var lower = 0.8\n\n    ctx.beginPath();\n    ctx.moveTo(Math.cos(start) * locations.circle.radius * lower + locations.circle.origin.x,\n        Math.sin(start) * locations.circle.radius * lower + locations.circle.origin.y)\n    ctx.lineTo(Math.cos(start) * locations.circle.radius * upper + locations.circle.origin.x,\n        Math.sin(start) * locations.circle.radius * upper + locations.circle.origin.y)\n    ctx.stroke();\n\n    //draw max\n\n    //draw selection highlight\n\n    var radius = locations.circle.radius\n    var origin = locations.circle.origin\n\n    var upperLeft = {x: Math.cos(start) * locations.circle.radius * upper + locations.circle.origin.x,\n        y: Math.sin(start) * locations.circle.radius * upper + locations.circle.origin.y}\n    var lowerLeft = {x: Math.cos(start) * locations.circle.radius * lower + locations.circle.origin.x,\n        y: Math.sin(start) * locations.circle.radius * lower + locations.circle.origin.y}\n    var upperRight = {x: Math.cos(pointer) * locations.circle.radius * upper + locations.circle.origin.x,\n        y: Math.sin(pointer) * locations.circle.radius * upper + locations.circle.origin.y}\n    var lowerRight = {x: Math.cos(pointer) * locations.circle.radius * lower + locations.circle.origin.x,\n        y: Math.sin(pointer) * locations.circle.radius * lower + locations.circle.origin.y}\n\n    ctx.fillStyle = 'rgba(95,154,220,0.5)'\n    ctx.beginPath()\n    ctx.moveTo(upperLeft.x, upperLeft.y)\n    ctx.lineTo(lowerLeft.x, lowerLeft.y)\n    if (((pointer - start > 0) && (pointer - start < Math.PI)) ||\n        ((Math.abs(pointer - start) > Math.PI) && (pointer - start < 0))\n    ){\n        ctx.arc(origin.x, origin.y, radius * upper, start, pointer, false)\n        ctx.lineTo(upperRight.x, upperRight.y)\n        ctx.lineTo(lowerRight.x, lowerRight.y)\n        ctx.arc(origin.x, origin.y, radius * lower, pointer, start, true)\n    } else {\n        ctx.arc(origin.x, origin.y, radius * upper, pointer, start, false)\n        ctx.lineTo(lowerRight.x, lowerRight.y)\n        ctx.lineTo(upperRight.x, upperRight.y)\n        ctx.arc(origin.x, origin.y, radius * lower, start, pointer, true)\n    }\n\n    ctx.fill()\n\n    //draw excess highlight\n\n}\n\nfunction drawPointer(ctx, locations){\n    var pointer = locations.selection.pointer\n    ctx.beginPath();\n    ctx.strokeStyle = 'rgb(68,68,68)'\n    ctx.moveTo(Math.cos(pointer) * locations.circle.radius * 0.8 + locations.circle.origin.x,\n        Math.sin(pointer) * locations.circle.radius * 0.8 + locations.circle.origin.y)\n    ctx.lineTo(Math.cos(pointer) * locations.circle.radius * 1.2 + locations.circle.origin.x,\n        Math.sin(pointer) * locations.circle.radius * 1.2 + locations.circle.origin.y)\n    ctx.stroke();\n}\n\nfunction drawPoly(ctx, locations){\n    ctx.drawImage(locations.image, locations.poly.x-50,locations.poly.y-125,window.innerWidth/6,window.innerWidth/6)\n\n}\n\nfunction drawCenter(ctx, locations) {\n    ctx.font = '24px Arial'\n    ctx.textAlign = 'center'\n    var locx = locations.circle.origin.x\n    var locy = locations.circle.origin.y\n    ctx.fillStyle = \"black\";\n    ctx.fillText(locations.seqName, locx, locy - 40)\n    ctx.font = '18px Arial'\n    var para = locations.purpose.split(' ')\n    var inc = 50\n    var yadjust = 0;\n    var text = '';\n    for (var i = 0; i < para.length; i++){\n        var text = text.concat(para[i], ' ')\n        if ((text.length > inc) || (i == para.length -1)) {\n            ctx.fillText(text, locx, locy + yadjust)\n            yadjust += 25;\n            text = '';\n        }\n    }\n}\n\nfunction drawFeatures(ctx, locations){\n    var radius = locations.circle.radius - 50;\n    var origin = locations.circle.origin\n    var length = locations.bases.length\n    if (length === 0){\n        length = 1\n    }\n\n    var lastend = 0;\n    var toggle = 0;\n    var radchange = 0.85;\n\n    for (var i = 0; i<locations.features.length; i++) {\n        var feat = locations.features[i]\n        if ((!['promoter','enhancer','misc_RNA','CDS','polyA_signal','rep_origin', 'repeat_region'].includes(feat.type))) {\n            continue\n        }\n        if (feat.start < lastend){\n            radius *= radchange\n            toggle = 1\n        }\n        var startRotation = Math.PI*2*feat.start/length\n        var endRotation = Math.PI*2*feat.end/length\n\n        var lower = Math.pow(0.95, (1/locations.zoom.zoomLevel))\n        var upper = Math.pow(1.05, (1/locations.zoom.zoomLevel))\n        var leftCos = Math.cos(startRotation)\n        var leftSin = Math.sin(startRotation)\n        var lowerLeft = {\n            x: leftCos * radius * lower + origin.x,\n            y: leftSin * radius * lower + origin.y\n        }\n        var upperLeft = {\n            x: leftCos * radius * upper + origin.x,\n            y: leftSin * radius * upper + origin.y\n        }\n\n        var arrowFrac = 2*Math.PI * (1/150)/locations.zoom.zoomLevel\n        if (Math.abs(startRotation - endRotation) < 0.25) {\n            arrowFrac = Math.abs(startRotation - endRotation) * 0.2\n        }\n\n        var rightCos = Math.cos(endRotation - arrowFrac)\n        var rightSin = Math.sin(endRotation - arrowFrac)\n        var lowerRight = {\n            x: rightCos * radius * lower + origin.x,\n            y: rightSin * radius * lower + origin.y\n        }\n\n        var midRight = {\n            x: Math.cos(endRotation) * radius + origin.x,\n            y: Math.sin(endRotation) * radius + origin.y\n        }\n\n        var upperRight = {\n            x: rightCos * radius * upper + origin.x,\n            y: rightSin * radius * upper + origin.y\n        }\n\n        ctx.fillStyle = random_rgb(feat.end / feat.start, 0.9)\n        ctx.beginPath()\n        ctx.moveTo(upperLeft.x, upperLeft.y)\n        ctx.lineTo(lowerLeft.x, lowerLeft.y)\n        ctx.arc(origin.x, origin.y, radius * upper, startRotation, endRotation - arrowFrac, false)\n        ctx.lineTo(upperRight.x, upperRight.y)\n        ctx.lineTo(midRight.x, midRight.y)\n        ctx.lineTo(lowerRight.x, lowerRight.y)\n        ctx.arc(origin.x, origin.y, radius * lower, endRotation - arrowFrac, startRotation, true)\n        ctx.fill()\n\n        ctx.strokeStyle = random_rgb(feat.end / feat.start, 0.8)\n        //ctx.strokeStyle = random_rgb(feat.end / feat.start)\n        ctx.stroke()\n\n        drawFeatureLabels(ctx, feat.name, radius, origin , startRotation, endRotation, lower, upper, feat.end, feat.start)\n\n        if((toggle == 1) && (locations.features[mod(i+1,locations.features.length)].start > lastend)){\n            radius *= (1/radchange)\n            toggle = 0\n        } else if (toggle == 0) {\n            lastend = feat.end\n        }\n    }\n}\n\nfunction drawFeatureLabels(ctx, name, radius, origin, start, end, lower, upper, endBase, startBase){\n    var fontheight = Math.max(Math.min((upper - lower)*radius/2,18),10)\n    var namelen = name.length * fontheight * 3.5\n    var textwidth = radius * (end - start) * 2 * Math.PI\n    if (namelen >= textwidth){\n        return;\n    }\n    ctx.fillStyle = 'black'\n    ctx.textAlign = \"center\"\n    var circumference = Math.PI * 2 * radius\n    var center = (end + start)/2\n    var textcolor = 'rgb(64,64,64)'\n    for (var i = 0; i < name.length; i++){\n        var spacing = (lower + (upper - lower)/3)\n        var startAngle = center - fontheight * 3.5 * (name.length/2 - i) / (2 * Math.PI * radius)\n        var rotation = startAngle + 0.5 * Math.PI\n        var letter = name[i]\n        var spacer2 = 0;\n        if (rotation > 0.5*Math.PI && rotation < 1.5 * Math.PI){\n            rotation += Math.PI\n            letter = name[name.length - i - 1]\n            spacing = (lower + (upper - lower)*2/3)\n        }\n        var x = origin.x + radius * Math.cos(startAngle) * spacing\n        var y = origin.y + radius * Math.sin(startAngle) * spacing\n        ctx.translate(x,y)\n        ctx.rotate(rotation)\n        ctx.fillStyle = textcolor\n        ctx.font = fontheight + 'px Andale Mono'\n        ctx.fillText(letter, 0, 0)\n        ctx.resetTransform();\n    }\n}\n\nfunction drawAnnotations(ctx, locations){\n    var circle = locations.circle\n    var origin = circle.origin\n    var textHeightMargin = 20\n    var maxAnnots = Math.floor(circle.radius * 4/textHeightMargin)\n    var circumferenceBases = locations.bases.length\n    var inflectRadius = circle.radius + 25\n    var endRadius = circle.radius + 75\n    var triedLocs = []\n    for (var i = 0; i<locations.features.length; i++) {\n        var feat = locations.features[i]\n        var startLoc = (feat.start/circumferenceBases) * Math.PI * 2\n        var circleSeq = (Math.floor((feat.start/circumferenceBases)*maxAnnots))\n        var idealSeq = circleSeq\n        if ((['promoter', 'enhancer', 'misc_RNA', 'CDS', 'polyA_signal', 'rep_origin', 'repeat_region'].includes(feat.type))) {\n            continue\n        }\n        // var asinArg = circleSeq * textHeightMargin/circle.radius\n        // var adder = 0\n        //\n        ctx.textAlign = 'left'\n        // if ((asinArg > 1) && (asinArg < 3)){\n        //     asinArg = asinArg - 2\n        //     adder += Math.PI\n        //     ctx.textAlign = 'right'\n        // } else if (asinArg > 3) {\n        //     asinArg = asinArg -4\n        //     adder -= 0\n        //     ctx.textAlign = 'left'\n        // }\n        var closeLoc = Math.PI * 2 * circleSeq / maxAnnots\n        var circleLoc = startLoc\n\n\n        for (var j = 0; j < triedLocs.length; j++){\n            var triedLoc = triedLocs[j]\n            var dist = Math.abs(Math.sin(circleLoc) - Math.sin(triedLoc)) * maxAnnots /2\n            if (dist < 1){\n                circleLoc += Math.PI * 2 / maxAnnots\n            }\n        }\n\n        if ((circleLoc > 0.5*Math.PI) && (circleLoc < 1.5 * Math.PI)){\n            ctx.textAlign = 'right'\n        }\n        ctx.beginPath()\n        ctx.strokeStyle = 'rgb(139,139,139)'\n\n        var startX = Math.cos(startLoc) * circle.radius + origin.x\n        var startY = Math.sin(startLoc) * circle.radius + origin.y\n        ctx.moveTo(startX, startY)\n\n        var inflectX = Math.cos(startLoc) * inflectRadius + origin.x\n        var inflectY = Math.sin(startLoc) * inflectRadius + origin.y\n        ctx.lineTo(inflectX, inflectY)\n\n        var endX = Math.cos(circleLoc) * endRadius + origin.x\n        var endY = Math.sin(circleLoc) * endRadius + origin.y\n        ctx.lineTo(endX, endY)\n        ctx.stroke()\n\n        var textX = Math.cos(circleLoc) * (endRadius + textHeightMargin/2) + origin.x\n        var textY = Math.sin(circleLoc) * (endRadius + textHeightMargin/2) + origin.y + textHeightMargin / 4\n\n        ctx.font = '12px Arial'\n        var rendertext = feat.name\n        if (rendertext.includes('Kozak') || rendertext.includes('kozak')) {\n            rendertext = 'Kozak sequence'\n        } else if (rendertext.length > 30) {\n            rendertext = rendertext.slice(0,30) + '...'\n        }\n        ctx.fillText(rendertext, textX, textY)\n\n        triedLocs = [...triedLocs, circleLoc]\n        if (triedLocs.length === maxAnnots){\n            break\n        }\n    }\n}\n\nfunction drawCircleGuide(ctx,locations){\n\n    var radius = locations.circle.radius\n    var origX = locations.circle.origin.x\n    var origY = locations.circle.origin.y\n\n    var transparency = 1 //Math.pow(1/locations.zoom.zoomLevel,0.5)\n\n    var strokeColor = `rgba(64,64,64,${transparency})`\n\n    ctx.beginPath();\n    ctx.arc(origX, origY, radius, 0, 2 * Math.PI, false);\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = strokeColor;\n    ctx.stroke();\n\n}\n\nfunction drawPlasmid(ctx,locations) {\n    var start = Math.floor(((locations.selection.start)/(Math.PI*2))*locations.bases.length)\n    var end = Math.floor(((locations.selection.end)/(Math.PI*2))*locations.bases.length)\n\n    var transparency = 1-Math.pow(1/locations.zoom.zoomLevel,0.5)\n    var strokeColor = `rgba(160,160,160,${transparency})`\n    //a = 'rgb(201,161,92)'\n    var inversion = false\n    if (((locations.selection.start - locations.selection.end > Math.PI) && (locations.selection.start > 1.5*Math.PI)) ||\n            ((locations.selection.start - locations.selection.end < -Math.PI) && (locations.selection.start < 0.5*Math.PI))){\n        var inversion = true\n    }\n    if(inversion === false) {\n        for (var i = start; i < end; i++) {\n\n            var base = locations.bases[i]\n            var base2 = locations.bases[mod(i + 1, locations.bases.length)]\n\n            ctx.beginPath()\n            ctx.arc(base.x, base.y, base.weight * locations.zoom.zoomLevel / 10, 0, 2 * Math.PI, false);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = strokeColor;\n            var fillColor = ''\n            if (base.letter === 'A') {\n                fillColor = `rgba(91,183,248,${transparency})`\n            } else if (base.letter === 'C') {\n                fillColor = `rgba(201,161,92,${transparency})`\n            } else if (base.letter === 'G') {\n                fillColor = `rgba(19,153,23,${transparency})`\n            } else if (base.letter === 'T') {\n                fillColor = `rgba(227,111,111,${transparency})`\n            } else {\n                fillColor = `rgba(255,255,255,${transparency})`\n            }\n            ctx.fillStyle = fillColor\n            ctx.stroke();\n            ctx.font = '24px Arial'\n            ctx.textAlign = 'center'\n            ctx.fillText(base.letter, base.x, base.y + 8)\n        }\n    } else if (start > end) {\n        for (var i = start; i < locations.bases.length + end; i++) {\n\n            var base = locations.bases[mod(i, locations.bases.length)]\n            var base2 = locations.bases[mod(i + 1, locations.bases.length)]\n\n            ctx.beginPath()\n            ctx.arc(base.x, base.y, base.weight * locations.zoom.zoomLevel / 10, 0, 2 * Math.PI, false);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = strokeColor;\n            var fillColor = ''\n            if (base.letter === 'A') {\n                fillColor = `rgba(91,183,248,${transparency})`\n            } else if (base.letter === 'C') {\n                fillColor = `rgba(201,161,92,${transparency})`\n            } else if (base.letter === 'G') {\n                fillColor = `rgba(19,153,23,${transparency})`\n            } else if (base.letter === 'T') {\n                fillColor = `rgba(227,111,111,${transparency})`\n            } else {\n                fillColor = `rgba(255,255,255,${transparency})`\n            }\n            ctx.fillStyle = fillColor\n            ctx.stroke();\n            ctx.font = '24px Arial'\n            ctx.textAlign = 'center'\n            ctx.fillText(base.letter, base.x, base.y + 8)\n        }\n    } else {\n        for (var i = start + locations.bases.length; i > end; i--) {\n            var base = locations.bases[mod(i, locations.bases.length)]\n            var base2 = locations.bases[mod(i + 1, locations.bases.length)]\n\n            ctx.beginPath()\n            ctx.arc(base.x, base.y, base.weight * locations.zoom.zoomLevel / 10, 0, 2 * Math.PI, false);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = strokeColor;\n            var fillColor = ''\n            if (base.letter === 'A') {\n                fillColor = `rgba(91,183,248,${transparency})`\n            } else if (base.letter === 'C') {\n                fillColor = `rgba(201,161,92,${transparency})`\n            } else if (base.letter === 'G') {\n                fillColor = `rgba(19,153,23,${transparency})`\n            } else if (base.letter === 'T') {\n                fillColor = `rgba(227,111,111,${transparency})`\n            } else {\n                fillColor = `rgba(255,255,255,${transparency})`\n            }\n            ctx.fillStyle = fillColor\n            ctx.stroke();\n            ctx.font = '24px Arial'\n            ctx.textAlign = 'center'\n            ctx.fillText(base.letter, base.x, base.y + 8)\n        }\n    }\n}\n\n// LOCATIONS AND FORCES SECTION ======================================================================\nfunction baseForceFromCircle(base, circle, length){\n    var center = getCircleLocation(base.number, length, circle)\n    var newBase = base\n\n    var damper = 3\n    if (Math.abs((center.x - newBase.x)) > 0) {\n        newBase.vx += (Math.pow(Math.abs((center.x - newBase.x)),0.5)*Math.sign(center.x - newBase.x)\n            + (Math.random()-0.5) * 10);\n    }\n\n    if (Math.abs((center.y - newBase.y)) > 0) {\n        newBase.vy += (Math.pow(Math.abs((center.y - newBase.y)),0.5)*Math.sign(center.y - newBase.y)\n            + (Math.random()-0.5) * 10);\n    }\n\n    newBase.vx *= 1/damper;\n    newBase.vy *= 1/damper;\n    newBase.x += newBase.vx\n    newBase.y += newBase.vy\n\n    return newBase\n}\n\nfunction getCircleLocation(baseNumber, basesLength, circle){\n    var increment = Math.PI * 2 / basesLength\n\n    var xval = Math.cos(increment * baseNumber) * (circle.radius + 25) + circle.origin.x\n    var yval = Math.sin(increment * baseNumber) * (circle.radius + 25) + circle.origin.y\n    return {x: xval, y: yval}\n}\n\nfunction zoomBroker(root, trigger, zoomedMax){\n    if ((root.zoom.isZooming === 0) && (trigger === true)){\n        //start zooming\n        root.zoom.zoomDirection *= -1\n        root.zoom.isZooming = 1\n        if (root.scenario === 'fullPlasmid'){\n            if(((root.selection.start - root.selection.end > Math.PI) && (root.selection.start > 1.5*Math.PI)) ||\n                ((root.selection.start - root.selection.end < -Math.PI) && (root.selection.start < 0.5*Math.PI))){\n            root.zoom.zoomCenter = (root.selection.start + root.selection.end)/2 + Math.PI} else {\n            root.zoom.zoomCenter = (root.selection.start + root.selection.end)/2\n            }\n        }\n    } else if ((root.zoom.isZooming === 1) && (\n        ((root.zoom.zoomLevel >= zoomedMax) && (root.zoom.zoomDirection === 1))\n    )){\n        //stop zooming\n        root.zoom.isZooming = 0\n        root.scenario = 'arc'\n    } else if ((root.zoom.isZooming === 1) && (\n        ((root.zoom.zoomLevel <= 1) && (root.zoom.zoomDirection === -1))\n\n    )){\n        root.zoom.isZooming = 0\n        root.scenario = 'fullPlasmid'\n    } else {\n        root.scenario = 'zoom'\n    }\n    return root\n}\n\nfunction zoomCircle(locations, trigger){\n\n    var startenddiff = (locations.selection.end) - (locations.selection.start)\n    if (startenddiff < -Math.PI){\n        startenddiff += Math.PI * 2\n    }\n    else if(((locations.selection.start - locations.selection.end > Math.PI) && (locations.selection.start > 1.5*Math.PI)) ||\n                ((locations.selection.start - locations.selection.end < -Math.PI) && (locations.selection.start < 0.5*Math.PI))){\n        startenddiff = -startenddiff + Math.PI * 2\n    }\n    var maxBasesOnZoom = Math.floor((((startenddiff)/(Math.PI*2))*locations.bases.length))\n    if(maxBasesOnZoom < 10){\n        maxBasesOnZoom = 10\n    }\n    var max = (locations.baseString.length/maxBasesOnZoom)/2\n    var root = zoomBroker(locations, trigger, max)\n    var startZoom = root.zoom.zoomLevel\n    var zoomSpeed = 1.05\n    var factor = Math.pow(zoomSpeed,root.zoom.zoomDirection)\n    var startRadius = root.circle.radius\n    root.circle.radius *= factor\n    root.zoom.zoomLevel *= factor\n    var windowContext = radiusSizer()\n    if (root.circle.radius < windowContext){\n        root.circle.radius = windowContext\n        root.zoom.zoomLevel = 1\n    } else if (root.circle.radius > (windowContext)*max) {\n        root.circle.radius = windowContext*max\n        root.zoom.zoomLevel = max\n    }\n    var adder = 0\n    var adderspeed = 5\n    if(true){\n        adder = root.zoom.zoomDirection * adderspeed\n    }\n    var radiff = root.circle.radius - startRadius + adder\n    var grow = factor\n    var center = root.zoom.zoomCenter + Math.PI\n    root.circle.origin.x += radiff * Math.cos(center)\n    root.circle.origin.y += radiff * Math.sin(center)\n    return root\n}\n\nfunction runPoly(locations, start, end){\n    var root = locations\n    var poly = root.poly\n    var scenario = root.scenario\n    if (poly.target < start){\n        poly.target = start\n        poly.x = -250\n        poly.y = -250\n        scenario = 'poly'\n    }\n    var target = root.bases[poly.target]\n    var diffx = target.x - poly.x\n    var diffy = target.y - poly.y\n    if (Math.abs(diffx+diffy) < 10){\n        root.poly.target += 1\n    } else {\n        poly.x += (diffx)/10\n        poly.y += (diffy)/10\n        if (poly.target > start) {\n            root.bases[poly.target].x -= 10\n            root.bases[poly.target].y -= 10\n            root.bases[poly.target + 1].x -= 7\n            root.bases[poly.target + 1].y -= 7\n            root.bases[poly.target + 2].x -= 4\n            root.bases[poly.target + 2].y -= 4\n        }\n    }\n    if (poly.target > end){\n        poly.target = -1\n        scenario = 'arc'\n    }\n    root = {...root, poly: poly, scenario: scenario}\n    return root\n}\n\nfunction runPointer (locations, mouse){\n    var root = locations\n    var origin = locations.circle.origin\n    var x = mouse.clientX\n    var y = mouse.clientY\n    var ydiff = y - origin.y\n    var xdiff = x - origin.x\n    var r = Math.sqrt(Math.pow(x - origin.x,2) + Math.pow(ydiff,2))\n    var angle = Math.atan2(ydiff,xdiff)\n    if (angle < 0){\n        angle += Math.PI * 2\n    }\n    var endmaxlength = 2*Math.PI/40\n    root.selection.pointer = angle\n    root.selection.mousex = x\n    root.selection.mousey = y\n    return root\n}\n\nfunction brokerMouseDrag(locations, event, direction){\n    var root = locations\n    if(direction == 'down'){\n        root.selection.activated = true\n        root.selection.start = root.selection.pointer\n    } else if (direction == 'up') {\n        root.selection.activated = false\n        root.selection.end = root.selection.pointer\n        if((root.selection.start > root.selection.end) && (root.selection.start - root.selection.end < Math.PI)) {\n            var temp = root.selection.start\n            root.selection.start = root.selection.end\n            root.selection.end = temp\n        }\n        root = zoomCircle(root, true)\n    }\n    if (locations.scenario == 'fullPlasmid'){\n\n    } else {\n        root = dragBases(root)\n    }\n    return root\n}\n\nfunction dragBases(locations){\n    var root = locations\n    return root\n}\n\n// TICKING SECTION ======================================================================\n\nfunction tickPlasmid(locations) {\n    var root = locations\n\n    if (root.zoom.isZooming === 1 ) {\n        root = zoomCircle(root, false)\n    }\n    var newBases = root.bases\n    var inversion = false\n    var radialstart = locations.selection.start\n    var radialend = locations.selection.end\n    if (((radialstart - radialend > Math.PI) && (radialstart > 1.5*Math.PI)) ||\n                ((radialstart - radialend < -Math.PI) && (radialstart < 0.5*Math.PI))){\n        var temp = radialstart\n        radialstart = radialend\n        radialend = temp\n        var inversion = true\n    }\n\n    var start = Math.floor((radialstart/(Math.PI * 2)) * locations.bases.length)\n    var end = Math.floor((radialend/(Math.PI * 2)) * locations.bases.length)\n    // if (start > end) {\n    //     var temp = start\n    //     start = end\n    //     end = temp\n    // }\n    // ((pointer - start > 0) && (pointer - start < Math.PI)) ||\n    //     ((Math.abs(pointer - start) > Math.PI) && (pointer - start < 0))\n\n    if ((root.scenario === 'arc') || (root.scenario === 'zoom') || (root.scenario === 'poly')) {\n        var lowerlimit, upperlimit\n        if (inversion === false){\n            lowerlimit = start\n            upperlimit = end\n        } else {\n            lowerlimit = end\n            upperlimit = start\n        }\n        if(inversion === false) {\n            for (var i = 0; i < root.bases.length; i++) {\n                var forcedBase = {}\n                if ((i >= lowerlimit) && (i <= upperlimit)) {\n                    newBases[i] = baseForceFromCircle(newBases[i], root.circle, root.bases.length)\n                }\n            }\n        } else {\n            for (var i = 0; i < root.bases.length; i++) {\n                var forcedBase = {}\n                if ((i <= lowerlimit) || (i >= upperlimit)) {\n                    newBases[i] = baseForceFromCircle(newBases[i], root.circle, root.bases.length)\n                }\n            }\n        }\n    }\n\n    root = {...root, bases: newBases}\n    var ticker = start\n\n    if (root.scenario === 'poly'){\n        root = runPoly(root, start, end)\n    }\n\n    return root\n}\n\n\n// HANDLER SECTION ======================================================================\n\nfunction Main() {\n    const [locations, setLocations, canvasRef] = usePersistentCanvas();\n\n    // TIMER ---------------------------------------------\n    React.useEffect(() => {\n        var timerID = setInterval(() => tickMaster(), 10);\n\n        return function cleanup() {\n\n        clearInterval(timerID);\n        };\n    })\n\n    function tickMaster() {\n        setLocations(tickPlasmid(locations))\n    }\n\n    // HANDLERS ---------------------------------------------\n\n      function handleCanvasClick(e) {\n\n      }\n\n      function handleDefault() {\n        setLocations(getFullDefault())\n      }\n\n      function handlePoly() {\n        if(locations.scenario === 'arc'){\n            setLocations({...locations, scenario:'poly'})\n        }\n      }\n\n      function handleZoom() {\n        setLocations(zoomCircle(locations, true))\n      }\n\n      function debug() {\n        console.log(locations)\n      }\n\n      function handleSeqChange(e) {\n        setLocations({...locations, link: e.target.value})\n      }\n\n      function executeSeqChange(){\n        setLocations(updatePlasmid(locations, locations.link))\n      }\n\n      function handleSeqSelection(e){\n        setLocations(updatePlasmid(locations, e.target.value))\n      }\n\n      function handleMouseMove(e) {\n        setLocations(runPointer(locations, e))\n      }\n\n      function handleMouseDown(e){\n        setLocations(brokerMouseDrag(locations, e, 'down'))\n      }\n\n      function handleMouseUp(e){\n        setLocations(brokerMouseDrag(locations, e, 'up'))\n      }\n\n      window.onresize = function() {\n        setLocations({...locations,\n\n          circle: {radius: radiusSizer(), origin:\n              {x:window.innerWidth*0.4, y:window.innerHeight/2}\n            }\n        })\n      }\n\n      function hamburgerTransform(){\n          document.getElementsByClassName('menu')[0].classList.toggle('change')\n          //docuemnt\n      }\n      ;\n\n      // RENDER JSX ---------------------------------------------\n\n      return (\n<div>\n\n    <canvas\n        ref={canvasRef}\n        style = {{\n            width: '100vw',\n            height: '100vh',\n            border: '1px solid black'\n        }}\n        onClick={handleCanvasClick}\n        onMouseMove={handleMouseMove}\n        onMouseDown={handleMouseDown}\n        onMouseUp = {handleMouseUp}\n        display= 'inline-block'\n    />\n    <div>\n        <div id=\"menuToggle\">\n            <input type=\"checkbox\" id = 'hamburger' onClick = {hamburgerTransform}/>\n            <span></span>\n            <span></span>\n            <span></span>\n            <div id=\"menu\" className = 'menu'>\n                <div id = 'selection' className = 'menuHeader'>1. Select a plasmid</div>\n                <select name='plasmids' id ='plasmidSelector' onChange = {handleSeqSelection}>\n                    <option value = 'https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/14/90/181490/addgene-plasmid-60957-sequence-181490.gbk'>PX551, Feng Zhang Lab (default)</option>\n                    <option value = 'https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/02/51/60251/addgene-plasmid-44250-sequence-60251.gbk'>pwtCas9, Stanley Qi Lab</option>\n                    <option value = 'https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/10/71/171071/addgene-plasmid-50474-sequence-171071.gbk'>mCherry, Bryan Roth Lab</option>\n                    <option value = 'https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/24/14/142414/addgene-plasmid-18917-sequence-142414.gbk'>tdTomato, Scott Sternson Lab</option>\n                    <option value = 'https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/06/36/200636/addgene-plasmid-17576-sequence-200636.gbk'>pLTR for human stem cells, Jakob Reiser Lab</option>\n                </select>\n                <label for='plasmid'>Or, enter the url for a <a href = 'https://www.ncbi.nlm.nih.gov/genbank/'><u>GenBank</u></a> (.gbk) file:</label>\n                <input type ='text' id='plasmid' placeholder = 'url' onChange = {handleSeqChange}></input>\n                <button id = 'plasmidGo' onClick = {executeSeqChange}>Go</button>\n\n                <div id = 'plasmid' className = 'menuHeader'>2. Plasmid Controls</div>\n                <button onClick={handleZoom}>Zoom</button>\n                <button onClick={handlePoly}>Poly</button>\n                <div id = 'debug' className = 'menuHeader'>Debug</div>\n                <button onClick={handleDefault}>Reset</button>\n                <button onClick={debug}>Console Dump</button>\n            </div>\n        </div>\n    </div>\n</div>\n    )\n}\n\nReactDOM.render(\n  <Main/>,\n  document.getElementById('root')\n);"],"sourceRoot":""}