(this["webpackJsonpcanvas-and-hooks"]=this["webpackJsonpcanvas-and-hooks"]||[]).push([[0],{13:function(e,t,a){},7:function(e,t,a){e.exports=a(8)},8:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a(2),r=a(3),i=a(5),c=a.n(i),s=a(0),l=a.n(s),h=(a(13),a(6));function g(e,t){return(e%t+t)%t}var u=m();function M(){var e=Object(s.useState)(u),t=Object(r.a)(e,2),a=t[0],n=t[1],i=l.a.useRef(null);return l.a.useEffect((function(){var e=i.current;e.width=e.offsetWidth,e.height=e.offsetHeight;var t=e.getContext("2d");t.clearRect(0,0,window.innerWidth,window.innerHeight),function(e,t){(function(e,t){var a=t.circle.radius,n=t.circle.origin.x,o=t.circle.origin.y,r="rgba(64,64,64,".concat(1,")");e.beginPath(),e.arc(n,o,a,0,2*Math.PI,!1),e.lineWidth=2,e.strokeStyle=r,e.stroke()})(e,t),function(e,t){var a=t.circle.radius-50,n=t.circle.origin,o=t.bases.length;0===o&&(o=1);for(var r=0,i=0,c=0;c<t.features.length;c++){var s=t.features[c];if(["promoter","enhancer","misc_RNA","CDS","polyA_signal","rep_origin","repeat_region"].includes(s.type)){s.start<r&&(a*=.85,i=1);var l=2*Math.PI*s.start/o,h=Math.pow(.95,1/t.zoom.zoomLevel),u=Math.pow(1.05,1/t.zoom.zoomLevel),M=Math.cos(l),f=Math.sin(l),m={x:M*a*h+n.x,y:f*a*h+n.y},y={x:M*a*u+n.x,y:f*a*u+n.y},v=2*Math.PI*s.end/t.baseString.length,b=2*Math.PI*(1/150)/t.zoom.zoomLevel;Math.abs(l-v)<.25&&(b=.2*Math.abs(l-v));var p=Math.cos(v-b),P=Math.sin(v-b),I={x:p*a*h+n.x,y:P*a*h+n.y},z={x:Math.cos(v)*a+n.x,y:Math.sin(v)*a+n.y},w={x:p*a*u+n.x,y:P*a*u+n.y};e.fillStyle=d(s.end/s.start,.9),e.beginPath(),e.moveTo(y.x,y.y),e.lineTo(m.x,m.y),e.arc(n.x,n.y,a*u,l,v-b,!1),e.lineTo(w.x,w.y),e.lineTo(z.x,z.y),e.lineTo(I.x,I.y),e.arc(n.x,n.y,a*h,v-b,l,!0),e.fill(),e.strokeStyle=d(s.end/s.start,.8),e.stroke(),x(e,s.name,a,n,l,v,h,u,s.end,s.start),1==i&&t.features[g(c+1,t.features.length)].start>r?(a*=1/.85,i=0):0==i&&(r=s.end)}}}(e,t),function(e,t){e.font="24px Arial",e.textAlign="center";var a=t.circle.origin.x,n=t.circle.origin.y;e.fillStyle="black",e.fillText(t.seqName,a,n-40),e.font="18px Arial";for(var o=t.purpose.split(" "),r=0,i="",c=0;c<o.length;c++){((i=i.concat(o[c]," ")).length>50||c==o.length-1)&&(e.fillText(i,a,n+r),r+=25,i="")}}(e,t),function(e,t){for(var a=t.circle,n=a.origin,r=Math.floor(4*a.radius/20),i=t.bases.length,c=a.radius+25,s=a.radius+75,l=[],h=0;h<t.features.length;h++){var g=t.features[h],u=g.start/i*Math.PI*2,M=Math.floor(g.start/i*r);if(!["promoter","enhancer","misc_RNA","CDS","polyA_signal","rep_origin","repeat_region"].includes(g.type)){e.textAlign="left";Math.PI;for(var d=u,f=0;f<l.length;f++){var m=l[f];Math.abs(Math.sin(d)-Math.sin(m))*r/2<1&&(d+=2*Math.PI/r)}d>.5*Math.PI&&d<1.5*Math.PI&&(e.textAlign="right"),e.beginPath(),e.strokeStyle="rgb(139,139,139)";var y=Math.cos(u)*a.radius+n.x,x=Math.sin(u)*a.radius+n.y;e.moveTo(y,x);var v=Math.cos(u)*c+n.x,b=Math.sin(u)*c+n.y;e.lineTo(v,b);var p=Math.cos(d)*s+n.x,P=Math.sin(d)*s+n.y;e.lineTo(p,P),e.stroke();var I=Math.cos(d)*(s+10)+n.x,z=Math.sin(d)*(s+10)+n.y+5;e.font="12px Arial";var w=g.name;if(w.includes("Kozak")||w.includes("kozak")?w="Kozak sequence":w.length>30&&(w=w.slice(0,30)+"..."),e.fillText(w,I,z),(l=[].concat(Object(o.a)(l),[d])).length===r)break}}}(e,t),"fullPlasmid"===t.scenario?(function(e,t){var a=t.selection.pointer;e.beginPath(),e.strokeStyle="rgb(68,68,68)",e.moveTo(Math.cos(a)*t.circle.radius*.8+t.circle.origin.x,Math.sin(a)*t.circle.radius*.8+t.circle.origin.y),e.lineTo(Math.cos(a)*t.circle.radius*1.2+t.circle.origin.x,Math.sin(a)*t.circle.radius*1.2+t.circle.origin.y),e.stroke()}(e,t),1==t.selection.activated&&function(e,t){var a=t.selection.start,n=t.selection.pointer;Math.PI,t.bases.length;e.strokeStyle="rgba(95,154,220,0.75)";e.beginPath(),e.moveTo(Math.cos(a)*t.circle.radius*.8+t.circle.origin.x,Math.sin(a)*t.circle.radius*.8+t.circle.origin.y),e.lineTo(Math.cos(a)*t.circle.radius*1.2+t.circle.origin.x,Math.sin(a)*t.circle.radius*1.2+t.circle.origin.y),e.stroke();var o=t.circle.radius,r=t.circle.origin,i={x:Math.cos(a)*t.circle.radius*1.2+t.circle.origin.x,y:Math.sin(a)*t.circle.radius*1.2+t.circle.origin.y},c={x:Math.cos(a)*t.circle.radius*.8+t.circle.origin.x,y:Math.sin(a)*t.circle.radius*.8+t.circle.origin.y},s={x:Math.cos(n)*t.circle.radius*1.2+t.circle.origin.x,y:Math.sin(n)*t.circle.radius*1.2+t.circle.origin.y},l={x:Math.cos(n)*t.circle.radius*.8+t.circle.origin.x,y:Math.sin(n)*t.circle.radius*.8+t.circle.origin.y};e.fillStyle="rgba(95,154,220,0.5)",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(c.x,c.y),n-a>0&&n-a<Math.PI||Math.abs(n-a)>Math.PI&&n-a<0?(e.arc(r.x,r.y,1.2*o,a,n,!1),e.lineTo(s.x,s.y),e.lineTo(l.x,l.y),e.arc(r.x,r.y,.8*o,n,a,!0)):(e.arc(r.x,r.y,1.2*o,n,a,!1),e.lineTo(l.x,l.y),e.lineTo(s.x,s.y),e.arc(r.x,r.y,.8*o,a,n,!0));e.fill()}(e,t)):"poly"===t.scenario?(!function(e,t){e.drawImage(t.image,t.poly.x-50,t.poly.y-125,window.innerWidth/6,window.innerWidth/6)}(e,t),v(e,t)):"arc"===t.scenario?v(e,t):"zoom"===t.scenario&&v(e,t)}(t,a)})),[a,n,i]}function d(e,t){var a=function(e){var t=1e4*Math.sin(e++);return t-Math.floor(t)}(e);return function(e,t,a){var n,o,r;if(e/=360,a/=100,0===(t/=100))n=o=r=a;else{var i=function(e,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?e+6*(t-e)*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e},c=a<.5?a*(1+t):a+t-a*t,s=2*a-c;n=i(s,c,e+1/3),o=i(s,c,e),r=i(s,c,e-1/3)}var l=function(e){var t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t};return"#".concat(l(n)).concat(l(o)).concat(l(r))}(360*a,75,(85+10*a)*t)}function f(){return Math.min(window.innerWidth/4,window.innerHeight/2.75)}function m(){new FileReader;for(var e=function(e){return h(e)}(function(e){var t,a=new XMLHttpRequest;return a.open("GET",e,!1),a.onreadystatechange=function(){4===a.readyState&&(200!==a.status&&0!=a.status||(t=a.responseText))},a.send(null),t}("https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/75/11/267511/addgene-plasmid-18916-sequence-267511.gbk"))[0],t={radius:f(),origin:{x:.4*window.innerWidth,y:window.innerHeight/2}},a=e.sequence.toUpperCase(),n=[],r=0;r<a.length;r++){var i=r,c=p(i,a.length,t),s={number:i,letter:a[r],x:c.x+100*(Math.random()-.5),y:c.y+100*(Math.random()-.5),vx:0,vy:0,weight:1};n=[].concat(Object(o.a)(n),[s])}var l=new Image;return l.src="https://upload.wikimedia.org/wikipedia/commons/7/7d/Eukaryotic_RNA-polymerase_II_structure_1WCM.png",{scenario:"fullPlasmid",circle:t,seqName:e.keywords,link:"https://www.addgene.org/60957/",purpose:e.definition,bases:n,baseString:a,annotations:y(),features:e.features,selection:{start:-.4*Math.PI,end:-.6*Math.PI,endmax:-.6*Math.PI,activated:!1,mousex:null,mousey:null},zoom:{pointer:null,zoomLevel:1,isZooming:0,zoomDirection:-1,zoomCenter:0},poly:{x:100,y:100,target:-1},image:l}}function y(){return[{name:"Waldo",locus:1232},{name:"Wanda",locus:23},{name:"Aries",locus:24}]}function x(e,t,a,n,o,r,i,c,s,l){var h=Math.max(Math.min((c-i)*a/2,18),10);if(!(t.length*h*3.5>=a*(r-o)*2*Math.PI)){e.fillStyle="black",e.textAlign="center";Math.PI;for(var g=(r+o)/2,u=0;u<t.length;u++){var M=i+(c-i)/3,d=g-3.5*h*(t.length/2-u)/(2*Math.PI*a),f=d+.5*Math.PI,m=t[u];f>.5*Math.PI&&f<1.5*Math.PI&&(f+=Math.PI,m=t[t.length-u-1],M=i+2*(c-i)/3);var y=n.x+a*Math.cos(d)*M,x=n.y+a*Math.sin(d)*M;e.translate(y,x),e.rotate(f),e.fillStyle="rgb(64,64,64)",e.font=h+"px Andale Mono",e.fillText(m,0,0),e.resetTransform()}}}function v(e,t){var a=Math.floor(t.selection.start/(2*Math.PI)*t.bases.length),n=Math.floor(t.selection.end/(2*Math.PI)*t.bases.length),o=1-Math.pow(1/t.zoom.zoomLevel,.5),r="rgba(160,160,160,".concat(o,")"),i=!1;if(t.selection.start-t.selection.end>Math.PI&&t.selection.start>1.5*Math.PI||t.selection.start-t.selection.end<-Math.PI&&t.selection.start<.5*Math.PI)i=!0;if(!1===i)for(var c=a;c<n;c++){var s=t.bases[c];t.bases[g(c+1,t.bases.length)];e.beginPath(),e.arc(s.x,s.y,s.weight*t.zoom.zoomLevel/10,0,2*Math.PI,!1),e.lineWidth=2,e.strokeStyle=r;var l="";l="A"===s.letter?"rgba(91,183,248,".concat(o,")"):"C"===s.letter?"rgba(201,161,92,".concat(o,")"):"G"===s.letter?"rgba(19,153,23,".concat(o,")"):"T"===s.letter?"rgba(227,111,111,".concat(o,")"):"rgba(255,255,255,".concat(o,")"),e.fillStyle=l,e.stroke(),e.font="24px Arial",e.textAlign="center",e.fillText(s.letter,s.x,s.y+8)}else if(a>n)for(c=a;c<t.bases.length+n;c++){s=t.bases[g(c,t.bases.length)],t.bases[g(c+1,t.bases.length)];e.beginPath(),e.arc(s.x,s.y,s.weight*t.zoom.zoomLevel/10,0,2*Math.PI,!1),e.lineWidth=2,e.strokeStyle=r;l="";l="A"===s.letter?"rgba(91,183,248,".concat(o,")"):"C"===s.letter?"rgba(201,161,92,".concat(o,")"):"G"===s.letter?"rgba(19,153,23,".concat(o,")"):"T"===s.letter?"rgba(227,111,111,".concat(o,")"):"rgba(255,255,255,".concat(o,")"),e.fillStyle=l,e.stroke(),e.font="24px Arial",e.textAlign="center",e.fillText(s.letter,s.x,s.y+8)}else for(c=a+t.bases.length;c>n;c--){s=t.bases[g(c,t.bases.length)],t.bases[g(c+1,t.bases.length)];e.beginPath(),e.arc(s.x,s.y,s.weight*t.zoom.zoomLevel/10,0,2*Math.PI,!1),e.lineWidth=2,e.strokeStyle=r;l="";l="A"===s.letter?"rgba(91,183,248,".concat(o,")"):"C"===s.letter?"rgba(201,161,92,".concat(o,")"):"G"===s.letter?"rgba(19,153,23,".concat(o,")"):"T"===s.letter?"rgba(227,111,111,".concat(o,")"):"rgba(255,255,255,".concat(o,")"),e.fillStyle=l,e.stroke(),e.font="24px Arial",e.textAlign="center",e.fillText(s.letter,s.x,s.y+8)}}function b(e,t,a){var n=p(e.number,a,t),o=e;return Math.abs(n.x-o.x)>0&&(o.vx+=Math.pow(Math.abs(n.x-o.x),.5)*Math.sign(n.x-o.x)+10*(Math.random()-.5)),Math.abs(n.y-o.y)>0&&(o.vy+=Math.pow(Math.abs(n.y-o.y),.5)*Math.sign(n.y-o.y)+10*(Math.random()-.5)),o.vx*=1/3,o.vy*=1/3,o.x+=o.vx,o.y+=o.vy,o}function p(e,t,a){var n=2*Math.PI/t;return{x:Math.cos(n*e)*(a.radius+25)+a.origin.x,y:Math.sin(n*e)*(a.radius+25)+a.origin.y}}function P(e,t){var a=e.selection.end-e.selection.start;a<-Math.PI?a+=2*Math.PI:(e.selection.start-e.selection.end>Math.PI&&e.selection.start>1.5*Math.PI||e.selection.start-e.selection.end<-Math.PI&&e.selection.start<.5*Math.PI)&&(a=-a+2*Math.PI);var n=Math.floor(a/(2*Math.PI)*e.bases.length);n<10&&(n=10);var o=e.baseString.length/n/2,r=function(e,t,a){return 0===e.zoom.isZooming&&!0===t?(e.zoom.zoomDirection*=-1,e.zoom.isZooming=1,"fullPlasmid"===e.scenario&&(e.selection.start-e.selection.end>Math.PI&&e.selection.start>1.5*Math.PI||e.selection.start-e.selection.end<-Math.PI&&e.selection.start<.5*Math.PI?e.zoom.zoomCenter=(e.selection.start+e.selection.end)/2+Math.PI:e.zoom.zoomCenter=(e.selection.start+e.selection.end)/2)):1===e.zoom.isZooming&&e.zoom.zoomLevel>=a&&1===e.zoom.zoomDirection?(e.zoom.isZooming=0,e.scenario="arc"):1===e.zoom.isZooming&&e.zoom.zoomLevel<=1&&-1===e.zoom.zoomDirection?(e.zoom.isZooming=0,e.scenario="fullPlasmid"):e.scenario="zoom",e}(e,t,o),i=(r.zoom.zoomLevel,Math.pow(1.05,r.zoom.zoomDirection)),c=r.circle.radius;r.circle.radius*=i,r.zoom.zoomLevel*=i;var s=f();r.circle.radius<s?(r.circle.radius=s,r.zoom.zoomLevel=1):r.circle.radius>s*o&&(r.circle.radius=s*o,r.zoom.zoomLevel=o);var l=0;l=5*r.zoom.zoomDirection;var h=r.circle.radius-c+l,g=r.zoom.zoomCenter+Math.PI;return r.circle.origin.x+=h*Math.cos(g),r.circle.origin.y+=h*Math.sin(g),r}function I(e,t,a){var n=e;if("down"==a)n.selection.activated=!0,n.selection.start=n.selection.pointer;else if("up"==a){if(n.selection.activated=!1,n.selection.end=n.selection.pointer,n.selection.start>n.selection.end&&n.selection.start-n.selection.end<Math.PI){var o=n.selection.start;n.selection.start=n.selection.end,n.selection.end=o}n=P(n,!0)}return"fullPlasmid"==e.scenario||(n=n),n}function z(e){var t=e;1===t.zoom.isZooming&&(t=P(t,!1));var a=t.bases,o=!1,r=e.selection.start,i=e.selection.end;if(r-i>Math.PI&&r>1.5*Math.PI||r-i<-Math.PI&&r<.5*Math.PI){var c=r;r=i,i=c;o=!0}var s,l,h=Math.floor(r/(2*Math.PI)*e.bases.length),g=Math.floor(i/(2*Math.PI)*e.bases.length);if("arc"===t.scenario||"zoom"===t.scenario||"poly"===t.scenario)if(!1===o?(s=h,l=g):(s=g,l=h),!1===o)for(var u=0;u<t.bases.length;u++){u>=s&&u<=l&&(a[u]=b(a[u],t.circle,t.bases.length))}else for(u=0;u<t.bases.length;u++){(u<=s||u>=l)&&(a[u]=b(a[u],t.circle,t.bases.length))}return"poly"===(t=Object(n.a)({},t,{bases:a})).scenario&&(t=function(e,t,a){var o=e,r=o.poly,i=o.scenario;r.target<t&&(r.target=t,r.x=-250,r.y=-250,i="poly");var c=o.bases[r.target],s=c.x-r.x,l=c.y-r.y;return Math.abs(s+l)<10?o.poly.target+=1:(r.x+=s/10,r.y+=l/10,r.target>t&&(o.bases[r.target].x-=10,o.bases[r.target].y-=10,o.bases[r.target+1].x-=7,o.bases[r.target+1].y-=7,o.bases[r.target+2].x-=4,o.bases[r.target+2].y-=4)),r.target>a&&(r.target=-1,i="arc"),o=Object(n.a)({},o,{poly:r,scenario:i})}(t,h,g)),t}c.a.render(l.a.createElement((function(){var e=M(),t=Object(r.a)(e,3),a=t[0],i=t[1],c=t[2];return l.a.useEffect((function(){var e=setInterval((function(){i(z(a))}),10);return function(){clearInterval(e)}})),window.onresize=function(){i(Object(n.a)({},a,{circle:{radius:f(),origin:{x:.4*window.innerWidth,y:window.innerHeight/2}}}))},l.a.createElement("div",null,l.a.createElement("canvas",{ref:c,style:{width:"100vw",height:"100vh",border:"1px solid black"},onClick:function(e){},onMouseMove:function(e){i(function(e,t){var a=e,n=e.circle.origin,o=t.clientX,r=t.clientY,i=r-n.y,c=o-n.x,s=(Math.sqrt(Math.pow(o-n.x,2)+Math.pow(i,2)),Math.atan2(i,c));return s<0&&(s+=2*Math.PI),Math.PI,a.selection.pointer=s,a.selection.mousex=o,a.selection.mousey=r,a}(a,e))},onMouseDown:function(e){i(I(a,0,"down"))},onMouseUp:function(e){i(I(a,0,"up"))},display:"inline-block"}),l.a.createElement("div",{className:"controls"},l.a.createElement("button",{onClick:function(){i(m())}},"Default"),l.a.createElement("button",{onClick:function(){i(P(a,!0))}},"Zoom"),l.a.createElement("button",{onClick:function(){"arc"===a.scenario&&i(Object(n.a)({},a,{scenario:"poly"}))}},"Poly"),l.a.createElement("button",{onClick:function(){console.log(a)}},"Debug"),l.a.createElement("input",{onChange:function(e){var t=a;t.bases=function(e,t,a,n){for(var r=a,i=0;i<e.length-t.length;i++){var c=a.length+i,s=p(c,e.length,n),l={number:c,letter:e[a.length+i],x:s.x+100*(Math.random()-.5),y:s.y+100*(Math.random()-.5),vx:0,vy:0,weight:1};r=[].concat(Object(o.a)(r),[l])}return r}(e.target.value,a.baseString,a.bases,a.circle),i(t),i(Object(n.a)({},a,{baseString:e.target.value}))}})))}),null),document.getElementById("root"))}},[[7,1,2]]]);
//# sourceMappingURL=main.08592c78.chunk.js.map