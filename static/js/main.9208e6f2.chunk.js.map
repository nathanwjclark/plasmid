{"version":3,"sources":["index.js"],"names":["mod","n","m","usePersistentCanvas","useState","scenario","circle","radius","radiusSizer","origin","x","window","innerWidth","y","innerHeight","seqName","link","purpose","bases","baseString","annotations","features","selection","pointer","start","end","endmax","activated","mousex","mousey","zoom","zoomLevel","isZooming","zoomDirection","zoomCenter","poly","target","image","locations","setLocations","canvasRef","React","useRef","useEffect","canvas","current","width","offsetWidth","height","offsetHeight","ctx","getContext","clearRect","origX","origY","strokeColor","beginPath","arc","Math","PI","lineWidth","strokeStyle","stroke","drawCircleGuide","length","lastend","toggle","i","feat","includes","type","startRotation","lower","pow","upper","leftCos","cos","leftSin","sin","lowerLeft","upperLeft","endRotation","arrowFrac","abs","rightCos","rightSin","lowerRight","midRight","upperRight","fillStyle","random_rgb","moveTo","lineTo","fill","drawFeatureLabels","name","drawFeatures","font","textAlign","locx","locy","fillText","para","split","yadjust","text","concat","drawCenter","maxAnnots","floor","circumferenceBases","inflectRadius","endRadius","triedLocs","startLoc","circleSeq","circleLoc","j","triedLoc","startX","startY","inflectX","inflectY","endX","endY","textX","textHeightMargin","textY","rendertext","slice","drawAnnotations","drawPointer","drawSelector","drawImage","drawPoly","drawPlasmid","drawMaster","seed","lightener","color","prng","h","s","l","r","g","b","hue2rgb","p","q","t","toHex","hex","round","toString","hslToHex","min","getFullDefault","FileReader","root","file","genbankParser","parseTextFile","allText","rawFile","XMLHttpRequest","open","onreadystatechange","readyState","status","responseText","send","readTextFile","newCircle","newString","sequence","toUpperCase","newBases","number","loc","getCircleLocation","addedBase","letter","random","vx","vy","weight","base_image","Image","src","keywords","definition","getDefaultAnnotations","locus","endBase","startBase","fontheight","max","center","spacing","startAngle","rotation","translate","rotate","resetTransform","transparency","inversion","base","fillColor","baseForceFromCircle","newBase","sign","baseNumber","basesLength","increment","zoomCircle","trigger","startenddiff","maxBasesOnZoom","zoomedMax","zoomBroker","factor","startRadius","windowContext","adder","radiff","brokerMouseDrag","event","direction","temp","tickPlasmid","radialstart","radialend","lowerlimit","upperlimit","diffx","diffy","runPoly","ReactDOM","render","timerID","setInterval","clearInterval","onresize","ref","style","border","onClick","e","onMouseMove","mouse","clientX","clientY","ydiff","xdiff","angle","sqrt","atan2","runPointer","onMouseDown","onMouseUp","display","className","console","log","onChange","clone","oldString","oldBases","updateBases","value","document","getElementById"],"mappings":"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","file":"static/js/main.9208e6f2.chunk.js","sourcesContent":["import ReactDOM from 'react-dom';\nimport React, { useState, createContext, useMemo, useCallback, useEffect } from 'react';\n// import './App.css'\nimport * as genbankParser from 'genbank-parser'\n\n// DECLARATION SECTION ======================================================================\n\nfunction mod(n, m) {\n  return ((n % m) + m) % m;\n}\n\nfunction usePersistentState(init) {\n  const [value, setValue] = React.useState(\n    //JSON.parse(localStorage.getItem('draw-app')) || init\n  )\n\n  React.useEffect(() => {\n    localStorage.setItem('draw-app', JSON.stringify(value))\n  })\n\n  return [value, setValue]\n}\n\nfunction usePersistentCanvas() {\n  const [locations, setLocations] = useState(init());\n\n  const canvasRef = React.useRef(null)\n\n  React.useEffect(() => {\n    const canvas = canvasRef.current\n    canvas.width = canvas.offsetWidth;\n    canvas.height = canvas.offsetHeight;\n    const ctx = canvas.getContext('2d')\n    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight)\n\n    drawMaster(ctx, locations)\n  })\n\n  return [locations, setLocations, canvasRef]\n}\n\nfunction init(){\n\n    var base_image = '';\n    //base_image.src = \"https://upload.wikimedia.org/wikipedia/commons/7/7d/Eukaryotic_RNA-polymerase_II_structure_1WCM.png\";\n    return {\n        scenario: 'fullPlasmid',\n        //scenario: fullPlasmid, arc, poly, zoom\n\n        circle:\n            {radius: radiusSizer(), origin:\n                {x:window.innerWidth*0.4, y:window.innerHeight/2}\n            },\n        //arc,\n        seqName: '',\n        link:'',\n        purpose: '',\n        bases:[],\n        baseString: '',\n        annotations:[],\n        features:[],\n        selection: {\n            pointer: null,\n            start: 0,\n            end: 0,\n            endmax: 0,\n            activated: false,\n            mousex: null,\n            mousey: null\n        },\n        zoom: {\n            zoomLevel: 1,\n            isZooming: 0,\n            zoomDirection: -1,\n            zoomCenter: 0\n        },\n        poly: {\n            x: 100,\n            y: 100,\n            target: -1\n        },\n        image: base_image\n    }\n}\n\nfunction readTextFile(file)\n{\n    var rawFile = new XMLHttpRequest();\n    var allText;\n    rawFile.open(\"GET\", file, false);\n    rawFile.onreadystatechange = function ()\n    {\n        if(rawFile.readyState === 4)\n        {\n            if(rawFile.status === 200 || rawFile.status == 0)\n            {\n                allText = rawFile.responseText;\n            }\n        }\n    }\n    rawFile.send(null);\n    return allText;\n}\n\nfunction prng(seed) {\n    var x = Math.sin(seed++) * 10000;\n    return x - Math.floor(x);\n}\n\nfunction hslToHex(h, s, l) {\n  h /= 360;\n  s /= 100;\n  l /= 100;\n  let r, g, b;\n  if (s === 0) {\n    r = g = b = l; // achromatic\n  } else {\n    const hue2rgb = (p, q, t) => {\n      if (t < 0) t += 1;\n      if (t > 1) t -= 1;\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\n      if (t < 1 / 2) return q;\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n      return p;\n    };\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n    const p = 2 * l - q;\n    r = hue2rgb(p, q, h + 1 / 3);\n    g = hue2rgb(p, q, h);\n    b = hue2rgb(p, q, h - 1 / 3);\n  }\n  const toHex = x => {\n    const hex = Math.round(x * 255).toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  };\n  return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\n}\n\nfunction random_rgb(seed, lightener) {\n    var color = prng(seed)\n    var hslbaseashex = hslToHex(360 * color,\n             75,\n             (85 + 10 * color) * lightener)\n    return hslbaseashex;\n}\n\nfunction radiusSizer(){\n    return Math.min(window.innerWidth/4,window.innerHeight/2.75)\n}\n\n// LOGICAL HELPERS ===============================================================================\n\nfunction loadFullChange(){\n\n}\n\nfunction loadPartialBaseChange(){\n\n}\n\nfunction stringToBases(baseString){\n\n    var temp = []\n\n    for (var i =0; i < baseString.length; i++) {\n        var base = {\n            base: baseString[i],\n            x: 100,\n            y: 100,\n            vx: 0,\n            vy: 0,\n            weight: 1\n        }\n        temp = [...temp,base]\n    }\n\n    return temp\n}\n\nfunction getDefaultBases() {\n    return 'ACCTGCGGGCCGTCTAAAAATTAAGGAAAAGCAGCAAAGGTGCATTTTTAAAATATGAAA\\n' +\n    'TGAAGATACCGCAGTACCAATTATTTTCGCAGTACAAATAATGCGCGGCCGGTGCATTTT\\n' +\n    'TCGAAAGAACGCGAGACAAACAGGACAATTAAAGTTAGTTTTTCGAGTTAGCGTGTTTGA\\n' +\n    'ATACTGCAAGATACAAGATAAATAGAGTAGTTGAAACTAGATATCAATTGCACACAAGAT\\n' +\n    'CGGCGCTAAGCATGCCACAATTTGGTATATTATGTAAAACACCACCTAAGGTGCTTGTTC\\n' +\n    'GTCAGTTTGTGGAAAGGTTTGAAAGACCTTCAGGTGAGAAAATAGCATTATGTGCTGCTG\\n' +\n    'AACTAACCTATTTATGTTGGATGATTACACATAACGGAACAGCAATCAAGAGAGCCACAT\\n' +\n    'TCATGAGCTATAATACTATCATAAGCAATTCGCTGAGTTTCGATATTGTCAATAAATCAC\\n' +\n    'TCCAGTTTAAATACAAGACGCAAAAAGCAACAATTCTGGAAGCCTCATTAAAGAAATTGA\\n' +\n    'TTCCTGCTTGGGAATTTACAATTATTCCTTACTATGGACAAAAACATCAATCTGATATCA\\n' +\n    'CTGATATTGTAAGTAGTTTGCAATTACAGTTCGAATCATCGGAAGAAGCAGATAAGGGAA\\n' +\n    'ATAGCCACAGTAAAAAAATGCTTAAAGCACTTCTAAGTGAGGGTGAAAGCATCTGGGAGA\\n' +\n    'TCACTGAGAAAATACTAAATTCGTTTGAGTATACTTCGAGATTTACAAAAACAAAAACTT\\n' +\n    'TATACCAATTCCTCTTCCTAGCTACTTTCATCAATTGTGGAAGATTCAGCGATATTAAGA\\n' +\n    'ACGTTGATCCGAAATCATTTAAATTAGTCCAAAATAAGTATCTGGGAGTAATAATCCAGT\\n' +\n    'GTTTAGTGACAGAGACAAAGACAAGCGTTAGTAGGCACATATACTTCTTTAGCGCAAGGG\\n' +\n    'GTAGGATCGATCCACTTGTATATTTGGATGAATTTTTGAGGAATTCTGAACCAGTCCTAA\\n' +\n    'AACGAGTAAATAGGACCGGCAATTCTTCAAGCAATAAACAGGAATACCAATTATTAAAAG\\n' +\n    'ATAACTTAGTCAGATCGTACAATAAAGCTTTGAAGAAAAATGCGCCTTATTCAATCTTTG\\n' +\n    'CTATAAAAAATGGCCCAAAATCTCACATTGGAAGACATTTGATGACCTCATTTCTTTCAA\\n' +\n    'TGAAGGGCCTAACGGAGTTGACTAATGTTGTGGGAAATTGGAGCGATAAGCGTGCTTCTG\\n' +\n    'CCGTGGCCAGGACAACGTATACTCATCAGATAACAGCAATACCTGATCACTACTTCGCAC\\n' +\n    'TAGTTTCTCGGTACTATGCATATGATCCAATATCAAAGGAAATGATAGCATTGAAGGATG\\n' +\n    'AGACTAATCCAATTGAGGAGTGGCAGCATATAGAACAGCTAAAGGGTAGTGCTGAAGGAA\\n' +\n    'GCATACGATACCCCGCATGGAATGGGATAATATCACAGGAGGTACTAGACTACCTTTCAT\\n' +\n    'CCTACATAAATAGACGCATATAAGTACGCATTTAAGCATAAACACGCACTATGCCGTTCT\\n' +\n    'TCTCATGTATATATATATACAGGCAACACGCAGATATAGGTGCGACGTGAACAGTGAGCT\\n' +\n    'GTATGTGCGCAGCTCGCGTTGCATTTTCGGAAGCGCTCGTTTTCGGAAACGCTTTGAAGT\\n' +\n    'TCCTATTCCGAAGTTCCTATTCTCTAGAAAGTATAGGAACTTCAGAGCGCTTTTGAAAAC\\n' +\n    'CAAAAGCGCTCTGAAGACGCACTTTCAAAAAACCAAAAACGCACCGGACTGTAACGAGCT\\n' +\n    'ACTAAAATATTGCGAATACCGCTTCCACAAACATTGCTCAAAAGTATCTCTTTGCTATAT\\n' +\n    'ATCTCTGTGCTATATCCCTATATAACCTACCCATCCACCTTTCGCTCCTTGAACTTGCAT\\n' +\n    'CTAAACTCGACCTCTACATCAACAGGCTTCCAATGCTCTTCAAATTTTACTGTCAAGTAG\\n' +\n    'ACCCATACGGCTGTAATATGCTGCTCTTCATAATGTAAGCTTATCTTTATCGAATCGTGT\\n' +\n    'GAAAAACTACTACCGCGATAAACCTTTACGGTTCCCTGAGATTGAATTAGTTCCTTTAGT\\n' +\n    'ATATGATACAAGACACTTTTGAACTTTGTACGACGAATTTTGAGGTTCGCCATCCTCTGG\\n' +\n    'CTATTTCCAATTATCCTGTCGGCTATTATCTCCGCCTCAGTTTGATCTTCCGCTTCAGAC\\n' +\n    'TGCCATTTTTCACATAATGAATCTATTTCACCCCACAATCCTTCATCCGCCTCCGCATCT\\n' +\n    'TGTTCCGTTAAACTATTGACTTCATGTTGTACATTGTTTAGTTCACGAGAAGGGTCCTCT\\n' +\n    'TCAGGCGGTAGCTCCTGATCTCCTATATGACCTTTATCCTGTTCTCTTTCCACAAACTTA\\n' +\n    'GAAATGTATTCATGAATTATGGAGCACCTAATAACATTCTTCAAGGCGGAGAAGTTTGGG\\n' +\n    'CCAGATGCCCAATATGCTTGACATGAAAACGTGAGAATGAATTTAGTATTATTGTGATAT\\n' +\n    'TCTGAGGCAATTTTATTATAATCTCGAAGATAAGAGAAGAATGCAGTGACCTTTGTATTG\\n' +\n    'ACAAATGGAGATTCCATGTATCTAAAAAATACGCCTTTAGGCCTTCTGATACCCTTTCCC\\n' +\n    'CTGCGGTTTAGCGTGCCTTTTACATTAATATCTAAACCCTCTCCGATGGTGGCCTTTAAC\\n' +\n    'TGACTAATAAATGCAACCGATATAAACTGTGATAATTCTGGGTGATTTATGATTCGATCG\\n' +\n    'ACAATTGTATTGTACACTAGTGCAGGATCAGGCCAATCCAGTTCTTTTTCAATTACCGGT\\n' +\n    'GTGTCGTCTGTATTCAGTACATGTCCAACAAATGCAAATGCTAACGTTTTGTATTTCTTA\\n' +\n    'TAATTGTCAGGAACTGGAAAAGTCCCCCTTGTCGTCTCGATTACACACCTACTTTCATCG\\n' +\n    'TACACCATAGGTTGGAAGTGCTGCATAATACATTGCTTAATACAAGCAAGCAGTCTCTCG\\n' +\n    'CCATTCATATTTCAGTTATTTTCCATTACAGCTGATGTCATTGTATATCAGCGCTGTAAA\\n' +\n    'AATCTATCTGTTACAGAAGGTTTTCGCGGTTTTTATAAACAAAACTTTCGTTACGAAATC\\n' +\n    'GAGCAATCACCCCAGCTGCGTATTTGGAAATTCGGGAAAAAGTAGAGCAACGCGAGTTGC\\n' +\n    'ATTTTTTACACCATAATGCATGATTAACTTCGAGAAGGGATTAAGGCTAATTTCACTAGT\\n' +\n    'ATGTTTCAAAAACCTCAATCTGTCCATTGAATGCCTTATAAAACAGCTATAGATTGCATA\\n' +\n    'GAAGAGTTAGCTACTCAATGCTTTTTGTCAAAGCTTACTGATGATGATGTGTCTACTTTC\\n' +\n    'AGGCGGGTCTGTAGTAAGGAGAATGACATTATAAAGCTGGCACTTAGAATTCCACGGACT\\n' +\n    'ATAGACTATACTAGTATACTCCGTCTACTGTACGATACACTTCCGCTCAGGTCCTTGTCC\\n' +\n    'TTTAACGAGGCCTTACCACTCTTTTGTTACTCTATTGATCCAGCTCAGCAAAGGCAGTGT\\n' +\n    'GATCTAAGATTCTATCTTCGCGATGTAGTAAAACTAGCTAGACCGAGAAAGAGACTAGAA\\n' +\n    'ATGCAAAAGGCACTTCTACAATGGCTGCCATCATTATTATCCGATGTGACGCTGCAGCTT\\n' +\n    'CTCAATGATATTCGAATACGCTTTGAGGAGATACAGCCTAATATCCGACAAACTGTTTTA\\n' +\n    'CAGATTTACGATCGTACTTGTTACCCATCATTGAATTTTGAACATCCGAACCTGGGAGTT\\n' +\n    'TTCCCTGAAACAGATAGTATATTTGAACCTGTATAATAATATATAGTCTAGCGCTTTACG\\n' +\n    'GAAGACAATGTATGTATTTCGGTTCCTGGAGAAACTATTGCATCTATTGCATAGGTAATC\\n' +\n    'TTGCACGTCGCATCCCCGGTTCATTTTCTGCGTTTCCATCTTGCACTTCAATAGCATATC\\n' +\n    'TTTGTTAACGAAGCATCTGTGCTTCATTTTGTAGAACAAAAATGCAACGCGAGAGCGCTA\\n' +\n    'ATTTTTCAAACAAAGAATCTGAGCTGCATTTTTACAGAACAGAAATGCAACGCGAAAGCG\\n' +\n    'CTATTTTACCAACGAAGAATCTGTGCTTCATTTTTGTAAAACAAAAATGCAACGCGAGAG\\n' +\n    'CGCTAATTTTTCAAACAAAGAATCTGAGCTGCATTTTTACAGAACAGAAATGCAACGCGA\\n' +\n    'GAGCGCTATTTTACCAACAAAGAATCTATACTTCTTTTTTGTTCTACAAAAATGCATCCC\\n' +\n    'GAGAGCGCTATTTTTCTAACAAAGCATCTTAGATTACTTTTTTTCTCCTTTGTGCGCTCT\\n' +\n    'ATAATGCAGTCTCTTGATAACTTTTTGCACTGTAGGTCCGTTAAGGTTAGAAGAAGGCTA\\n' +\n    'CTTTGGTGTCTATTTTCTCTTCCATAAAAAAAGCCTGACTCCACTTCCCGCGTTTACTGA\\n' +\n    'TTACTAGCGAAGCTGCGGGTGCATTTTTTCAAGATAAAGGCATCCCCGATTATATTCTAT\\n' +\n    'ACCGATGTGGATTGCGCATACTTTGTGAACAGAAAGTGATAGCGTTGATGATTCTTCATT\\n' +\n    'GGTCAGAAAATTATGAACGGTTTCTTCTATTTTGTCTCTATATACTACGTATAGGAAATG\\n' +\n    'TTTACATTTTCGTATTGTTTTCGATTCACTCTATGAATAGTTCTTACTACAATTTTTTTG\\n' +\n    'TCTAAAGAGTAATACTAGAGATAAACATAAAAAATGTAGAGGTCGAGTTTAGATGCAAGT\\n' +\n    'TCAAGGAGCGAAAGGTGGATGGGTAGGTTATATAGGGATATAGCACAGAGATATATAGCA\\n' +\n    'AAGAGATACTTTTGAGCAATGTTTGTGGAAGCGGTATTCGCAATATTTTAGTAGCTCGTT\\n' +\n    'ACAGTCCGGTGCGTTTTTGGTTTTTTGAAAGTGCGTCTTCAGAGCGCTTTTGGTTTTCAA\\n' +\n    'AAGCGCTCTGAAGTTCCTATACTTTCTAGAGAATAGGAACTTCGGAATAGGAACTTCAAA\\n' +\n    'GCGTTTCCGAAAACGAGCGCTTCCGAAAATGCAACGCGAGCTGCGCACATACAGCTCACT\\n' +\n    'GTTCACGTCGCACCTATATCTGCGTGTTGCCTGTATATATATATACATGAGAAGAACGGC\\n' +\n    'ATAGTGCGTGTTTATGCTTAAATGCGTACTTATATGCGTCTATTTATGTAGGATGAAAGG\\n' +\n    'TAGTCTAGTACCTCCTGTGATATTATCCCATTCCATGCGGGGTATCGTATGCTTCCTTCA\\n' +\n    'GCACTACCCTTTAGCTGTTCTATATGCTGCCACTCCTCAATTGGATTAGTCTCATCCTTC\\n' +\n    'AATGCTATCATTTCCTTTGATATTGGATCATACCCTAGAAGTATTACGTGATTTTCTGCC\\n' +\n    'CCTTACCCTCGTTGCTACTCTCCTTTTTTTCGTGGGAACCGCTTTAGGGCCCTCAGTGAT\\n' +\n    'GGTGTTTTGTAATTTATATGCTCCTCTTGCATTTGTGTCTCTACTTCTTGTTCGCCTGGA\\n' +\n    'GGGAACTTCTTCATTTGTATTAGCATGGTTCACTTCAGTCCTTCCTTCCAACTCACTCTT\\n' +\n    'TTTTTGCTGTAAACGATTCTCTGCCGCCAGTTCATTGAAACTATTGAATATATCCTTTAG\\n' +\n    'AGATTCCGGGATGAATAAATCACCTATTAAAGCAGCTTGACGATCTGGTGGAACTAAAGT\\n' +\n    'AAGCAATTGGGTAACGACGCTTACGAGCTTCATAACATCTTCTTCCGTTGGAGCTGGTGG\\n' +\n    'GACTAATAACTGTGTACAATCCATTTTTCTCATGAGCATTTCGGTAGCTCTCTTCTTGTC\\n' +\n    'TTTCTCGGGCAATCTTCCTATTATTATAGCAATAGATTTGTATAGTTGCTTTCTATTGTC\\n' +\n    'TAACAGCTTGTTATTCTGTAGCATCAAATCTATGGCAGCCTGACTTGCTTCTTGTGAAGA\\n' +\n    'GAGCATACCATTTCCAATCGAATCAAACCTTTCCTTAACCATCTTCGCAGCAGGCAAAAT\\n' +\n    'TACCTCAGCACTGGAGTCAGAAGATACGCTGGAATCTTCTGCGCTAGAATCAAGACCATA\\n' +\n    'CGGCCTACCGGTTGTGAGAGATTCCATGGGCCTTATGACATATCCTGGAAAGAGTAGCTC\\n' +\n    'ATCAGACTTACGTTTACTCTCTATATCAATATCTACATCAGGAGCAATCATTTCAATAAA\\n' +\n    'CAGCCGACATACATCCCAGACGCTATAAGCTGTACGTGCTTTTACCGTCAGATTCTTGGC\\n' +\n    'TGTTTCAATGTCGTCCATTTTGGTTTTCTTTTACCAGTATTGTTCGTTTGATAATGTATT\\n' +\n    'CTTGCTTATTACATTATAAAATCTGTGCAGATCACATGTCAAAACAACTTTTTATCACAA\\n' +\n    'GATAGTACCGCAAAACGA'\n}\n\nfunction parseTextFile(file){\n    var parsedFile = genbankParser(file)\n    return parsedFile\n}\n\nfunction getFullDefault() {\n\n    var reader = new FileReader();\n    var genbank = ''\n    var result = ''\n    var file = parseTextFile(readTextFile('https://media.addgene.org/snapgene-media/v1.6.2-0-g4b4ed87/sequences/75/11/267511/addgene-plasmid-18916-sequence-267511.gbk'))\n    var root = file[0]\n\n    var newCircle = {radius: radiusSizer(), origin:\n                {x:window.innerWidth*0.4, y:window.innerHeight/2}\n        }\n\n    var newString = root.sequence.toUpperCase()\n    var newBases = []\n    for (var i=0; i < newString.length; i++) {\n        var number = i\n        var loc = getCircleLocation(number, newString.length, newCircle)\n        var addedBase = {\n            number: number,\n            letter: newString[i],\n            x: loc.x + (Math.random() - 0.5) * 100,\n            y: loc.y + (Math.random() - 0.5) * 100,\n            vx: 0,\n            vy: 0,\n            weight: 1\n        }\n        newBases = [...newBases, addedBase]\n    }\n\n    var base_image = new Image();\n    base_image.src = \"https://upload.wikimedia.org/wikipedia/commons/7/7d/Eukaryotic_RNA-polymerase_II_structure_1WCM.png\";\n\n    var newLocations = {\n        scenario: 'fullPlasmid',\n        circle: newCircle,\n        seqName:root.keywords,\n        link: 'https://www.addgene.org/60957/',\n        purpose: root.definition,\n        bases:newBases,\n        baseString: newString,\n        annotations:getDefaultAnnotations(),\n        features:root.features,\n        selection: {\n            start: Math.PI * (-0.4),\n            end: Math.PI * (-0.6),\n            endmax: Math.PI * (-0.6),\n            activated: false,\n            mousex: null,\n            mousey: null\n        },\n        zoom: {\n            pointer: null,\n            zoomLevel: 1,\n            isZooming: 0,\n            zoomDirection: -1,\n            zoomCenter: 0\n        },\n        poly: {\n            x: 100,\n            y: 100,\n            target: -1\n        },\n        image: base_image\n    }\n\n    return newLocations\n}\n\nfunction getDefaultFeatures(){\n    var features = [\n        {\n            name: 'Cas9',\n            start: 0,\n            end: 2735,\n            color: '#e39bbf'\n        },\n        {\n            name: 'EcoR1',\n            start: 2736,\n            end: 4023,\n            color: '#87bbdc'\n        },\n        {\n            name: 'TANF',\n            start: 4324,\n            end: 4978,\n            color: '#f5c1a0'\n        }\n    ]\n    return features\n}\n\nfunction getDefaultAnnotations(){\n    var anns = [\n        {\n            name: 'Waldo',\n            locus: 1232\n        },\n        {\n            name: 'Wanda',\n            locus: 23\n        },\n        {\n            name: 'Aries',\n            locus: 24\n        }\n    ]\n    return anns\n}\n\nfunction updateBases(newString, oldString, oldBases, circle) {\n    // need to handle base insertion or deletion later on\n    var newBases = oldBases\n\n    for (var i=0; i < (newString.length - oldString.length); i++) {\n        var number = oldBases.length + i\n        var loc = getCircleLocation(number, newString.length, circle)\n        var addedBase = {\n            number: number,\n            letter: newString[oldBases.length + i],\n            x: loc.x + (Math.random() - 0.5) * 100,\n            y: loc.y + (Math.random() - 0.5) * 100,\n            vx: 0,\n            vy: 0,\n            weight: 1\n        }\n        newBases = [...newBases, addedBase]\n    }\n\n    return newBases\n}\n\n// DRAWING SECTION ======================================================================\n\nfunction drawMaster(ctx,locations) {\n\n    drawCircleGuide(ctx, locations)\n    drawFeatures(ctx, locations)\n    drawCenter(ctx, locations)\n    drawAnnotations(ctx, locations)\n\n    if (locations.scenario === 'fullPlasmid') {\n\n        drawPointer(ctx, locations)\n        if(locations.selection.activated == true){\n            drawSelector(ctx, locations)\n        }\n    } else if (locations.scenario === 'poly') {\n        drawPoly(ctx, locations)\n        drawPlasmid(ctx, locations)\n        // drawRNAPol(ctx,locations)\n        // drawMRNA(ctx,locations)\n        // drawRibosome(ctx,locations)\n        // drawAminos(ctx,locations)\n        // drawProtein(ctx,locations)\n    } else if (locations.scenario === 'arc') {\n        drawPlasmid(ctx, locations)\n        // drawArc(ctx,locations)\n        // drawArcBases(ctx,locations)\n    } else if (locations.scenario === 'zoom') {\n        drawPlasmid(ctx, locations)\n        // drawCircleGuide(ctx,locations)\n        // drawPlasmid(ctx,locations)\n        // drawArc(ctx,locations)\n        // drawArcBases(ctx,locations)\n    }\n}\n\nfunction drawSelector(ctx, locations) {\n    var start = locations.selection.start\n    var pointer = locations.selection.pointer\n\n    var baseMax = 1000\n    var max = Math.PI * 2 * baseMax / locations.bases.length\n\n    ctx.strokeStyle = 'rgba(95,154,220,0.75)'\n    //draw start\n    var upper = 1.2\n    var lower = 0.8\n\n    ctx.beginPath();\n    ctx.moveTo(Math.cos(start) * locations.circle.radius * lower + locations.circle.origin.x,\n        Math.sin(start) * locations.circle.radius * lower + locations.circle.origin.y)\n    ctx.lineTo(Math.cos(start) * locations.circle.radius * upper + locations.circle.origin.x,\n        Math.sin(start) * locations.circle.radius * upper + locations.circle.origin.y)\n    ctx.stroke();\n\n    //draw max\n\n    //draw selection highlight\n\n    var radius = locations.circle.radius\n    var origin = locations.circle.origin\n\n    var upperLeft = {x: Math.cos(start) * locations.circle.radius * upper + locations.circle.origin.x,\n        y: Math.sin(start) * locations.circle.radius * upper + locations.circle.origin.y}\n    var lowerLeft = {x: Math.cos(start) * locations.circle.radius * lower + locations.circle.origin.x,\n        y: Math.sin(start) * locations.circle.radius * lower + locations.circle.origin.y}\n    var upperRight = {x: Math.cos(pointer) * locations.circle.radius * upper + locations.circle.origin.x,\n        y: Math.sin(pointer) * locations.circle.radius * upper + locations.circle.origin.y}\n    var lowerRight = {x: Math.cos(pointer) * locations.circle.radius * lower + locations.circle.origin.x,\n        y: Math.sin(pointer) * locations.circle.radius * lower + locations.circle.origin.y}\n\n    ctx.fillStyle = 'rgba(95,154,220,0.5)'\n    ctx.beginPath()\n    ctx.moveTo(upperLeft.x, upperLeft.y)\n    ctx.lineTo(lowerLeft.x, lowerLeft.y)\n    if (((pointer - start > 0) && (pointer - start < Math.PI)) ||\n        ((Math.abs(pointer - start) > Math.PI) && (pointer - start < 0))\n    ){\n        ctx.arc(origin.x, origin.y, radius * upper, start, pointer, false)\n        ctx.lineTo(upperRight.x, upperRight.y)\n        ctx.lineTo(lowerRight.x, lowerRight.y)\n        ctx.arc(origin.x, origin.y, radius * lower, pointer, start, true)\n    } else {\n        ctx.arc(origin.x, origin.y, radius * upper, pointer, start, false)\n        ctx.lineTo(lowerRight.x, lowerRight.y)\n        ctx.lineTo(upperRight.x, upperRight.y)\n        ctx.arc(origin.x, origin.y, radius * lower, start, pointer, true)\n    }\n\n    ctx.fill()\n\n    //draw excess highlight\n\n}\n\nfunction drawPointer(ctx, locations){\n    var pointer = locations.selection.pointer\n    ctx.beginPath();\n    ctx.strokeStyle = 'rgb(68,68,68)'\n    ctx.moveTo(Math.cos(pointer) * locations.circle.radius * 0.8 + locations.circle.origin.x,\n        Math.sin(pointer) * locations.circle.radius * 0.8 + locations.circle.origin.y)\n    ctx.lineTo(Math.cos(pointer) * locations.circle.radius * 1.2 + locations.circle.origin.x,\n        Math.sin(pointer) * locations.circle.radius * 1.2 + locations.circle.origin.y)\n    ctx.stroke();\n}\n\nfunction drawPoly(ctx, locations){\n    ctx.drawImage(locations.image, locations.poly.x-50,locations.poly.y-125,window.innerWidth/6,window.innerWidth/6)\n\n}\n\nfunction drawCenter(ctx, locations) {\n    ctx.font = '24px Arial'\n    ctx.textAlign = 'center'\n    var locx = locations.circle.origin.x\n    var locy = locations.circle.origin.y\n    ctx.fillStyle = \"black\";\n    ctx.fillText(locations.seqName, locx, locy - 40)\n    ctx.font = '18px Arial'\n    var para = locations.purpose.split(' ')\n    var inc = 50\n    var yadjust = 0;\n    var text = '';\n    for (var i = 0; i < para.length; i++){\n        var text = text.concat(para[i], ' ')\n        if ((text.length > inc) || (i == para.length -1)) {\n            ctx.fillText(text, locx, locy + yadjust)\n            yadjust += 25;\n            text = '';\n        }\n    }\n}\n\nfunction drawFeatures(ctx, locations){\n    var radius = locations.circle.radius - 50;\n    var origin = locations.circle.origin\n    var length = locations.bases.length\n    if (length === 0){\n        length = 1\n    }\n\n    var lastend = 0;\n    var toggle = 0;\n    var radchange = 0.85;\n\n    for (var i = 0; i<locations.features.length; i++) {\n        var feat = locations.features[i]\n        if ((!['promoter','enhancer','misc_RNA','CDS','polyA_signal','rep_origin', 'repeat_region'].includes(feat.type))) {\n            continue\n        }\n        if (feat.start < lastend){\n            radius *= radchange\n            toggle = 1\n        }\n        var startRotation = Math.PI*2*feat.start/length\n        var lower = Math.pow(0.95, (1/locations.zoom.zoomLevel))\n        var upper = Math.pow(1.05, (1/locations.zoom.zoomLevel))\n        var leftCos = Math.cos(startRotation)\n        var leftSin = Math.sin(startRotation)\n        var lowerLeft = {\n            x: leftCos * radius * lower + origin.x,\n            y: leftSin * radius * lower + origin.y\n        }\n        var upperLeft = {\n            x: leftCos * radius * upper + origin.x,\n            y: leftSin * radius * upper + origin.y\n        }\n\n        var endRotation = Math.PI*2*feat.end/locations.baseString.length\n        var arrowFrac = 2*Math.PI * (1/150)/locations.zoom.zoomLevel\n        if (Math.abs(startRotation - endRotation) < 0.25) {\n            arrowFrac = Math.abs(startRotation - endRotation) * 0.2\n        }\n\n        var rightCos = Math.cos(endRotation - arrowFrac)\n        var rightSin = Math.sin(endRotation - arrowFrac)\n        var lowerRight = {\n            x: rightCos * radius * lower + origin.x,\n            y: rightSin * radius * lower + origin.y\n        }\n\n        var midRight = {\n            x: Math.cos(endRotation) * radius + origin.x,\n            y: Math.sin(endRotation) * radius + origin.y\n        }\n\n        var upperRight = {\n            x: rightCos * radius * upper + origin.x,\n            y: rightSin * radius * upper + origin.y\n        }\n\n        ctx.fillStyle = random_rgb(feat.end / feat.start, 0.9)\n        ctx.beginPath()\n        ctx.moveTo(upperLeft.x, upperLeft.y)\n        ctx.lineTo(lowerLeft.x, lowerLeft.y)\n        ctx.arc(origin.x, origin.y, radius * upper, startRotation, endRotation - arrowFrac, false)\n        ctx.lineTo(upperRight.x, upperRight.y)\n        ctx.lineTo(midRight.x, midRight.y)\n        ctx.lineTo(lowerRight.x, lowerRight.y)\n        ctx.arc(origin.x, origin.y, radius * lower, endRotation - arrowFrac, startRotation, true)\n        ctx.fill()\n\n        ctx.strokeStyle = random_rgb(feat.end / feat.start, 0.8)\n        //ctx.strokeStyle = random_rgb(feat.end / feat.start)\n        ctx.stroke()\n\n        drawFeatureLabels(ctx, feat.name, radius, origin , startRotation, endRotation, lower, upper, feat.end, feat.start)\n\n        if((toggle == 1) && (locations.features[mod(i+1,locations.features.length)].start > lastend)){\n            radius *= (1/radchange)\n            toggle = 0\n        } else if (toggle == 0) {\n            lastend = feat.end\n        }\n    }\n}\n\nfunction drawFeatureLabels(ctx, name, radius, origin, start, end, lower, upper, endBase, startBase){\n    var fontheight = Math.max(Math.min((upper - lower)*radius/2,18),10)\n    var namelen = name.length * fontheight * 3.5\n    var textwidth = radius * (end - start) * 2 * Math.PI\n    if (namelen >= textwidth){\n        return;\n    }\n    ctx.fillStyle = 'black'\n    ctx.textAlign = \"center\"\n    var circumference = Math.PI * 2 * radius\n    var center = (end + start)/2\n    var textcolor = 'rgb(64,64,64)'\n    for (var i = 0; i < name.length; i++){\n        var spacing = (lower + (upper - lower)/3)\n        var startAngle = center - fontheight * 3.5 * (name.length/2 - i) / (2 * Math.PI * radius)\n        var rotation = startAngle + 0.5 * Math.PI\n        var letter = name[i]\n        var spacer2 = 0;\n        if (rotation > 0.5*Math.PI && rotation < 1.5 * Math.PI){\n            rotation += Math.PI\n            letter = name[name.length - i - 1]\n            spacing = (lower + (upper - lower)*2/3)\n        }\n        var x = origin.x + radius * Math.cos(startAngle) * spacing\n        var y = origin.y + radius * Math.sin(startAngle) * spacing\n        ctx.translate(x,y)\n        ctx.rotate(rotation)\n        ctx.fillStyle = textcolor\n        ctx.font = fontheight + 'px Andale Mono'\n        ctx.fillText(letter, 0, 0)\n        ctx.resetTransform();\n    }\n}\n\nfunction drawAnnotations(ctx, locations){\n    var circle = locations.circle\n    var origin = circle.origin\n    var textHeightMargin = 20\n    var maxAnnots = Math.floor(circle.radius * 4/textHeightMargin)\n    var circumferenceBases = locations.bases.length\n    var inflectRadius = circle.radius + 25\n    var endRadius = circle.radius + 75\n    var triedLocs = []\n    for (var i = 0; i<locations.features.length; i++) {\n        var feat = locations.features[i]\n        var startLoc = (feat.start/circumferenceBases) * Math.PI * 2\n        var circleSeq = (Math.floor((feat.start/circumferenceBases)*maxAnnots))\n        var idealSeq = circleSeq\n        if ((['promoter', 'enhancer', 'misc_RNA', 'CDS', 'polyA_signal', 'rep_origin', 'repeat_region'].includes(feat.type))) {\n            continue\n        }\n        // var asinArg = circleSeq * textHeightMargin/circle.radius\n        // var adder = 0\n        //\n        ctx.textAlign = 'left'\n        // if ((asinArg > 1) && (asinArg < 3)){\n        //     asinArg = asinArg - 2\n        //     adder += Math.PI\n        //     ctx.textAlign = 'right'\n        // } else if (asinArg > 3) {\n        //     asinArg = asinArg -4\n        //     adder -= 0\n        //     ctx.textAlign = 'left'\n        // }\n        var closeLoc = Math.PI * 2 * circleSeq / maxAnnots\n        var circleLoc = startLoc\n\n\n        for (var j = 0; j < triedLocs.length; j++){\n            var triedLoc = triedLocs[j]\n            var dist = Math.abs(Math.sin(circleLoc) - Math.sin(triedLoc)) * maxAnnots /2\n            if (dist < 1){\n                circleLoc += Math.PI * 2 / maxAnnots\n            }\n        }\n\n        if ((circleLoc > 0.5*Math.PI) && (circleLoc < 1.5 * Math.PI)){\n            ctx.textAlign = 'right'\n        }\n        ctx.beginPath()\n        ctx.strokeStyle = 'rgb(139,139,139)'\n\n        var startX = Math.cos(startLoc) * circle.radius + origin.x\n        var startY = Math.sin(startLoc) * circle.radius + origin.y\n        ctx.moveTo(startX, startY)\n\n        var inflectX = Math.cos(startLoc) * inflectRadius + origin.x\n        var inflectY = Math.sin(startLoc) * inflectRadius + origin.y\n        ctx.lineTo(inflectX, inflectY)\n\n        var endX = Math.cos(circleLoc) * endRadius + origin.x\n        var endY = Math.sin(circleLoc) * endRadius + origin.y\n        ctx.lineTo(endX, endY)\n        ctx.stroke()\n\n        var textX = Math.cos(circleLoc) * (endRadius + textHeightMargin/2) + origin.x\n        var textY = Math.sin(circleLoc) * (endRadius + textHeightMargin/2) + origin.y + textHeightMargin / 4\n\n        ctx.font = '12px Arial'\n        var rendertext = feat.name\n        if (rendertext.includes('Kozak') || rendertext.includes('kozak')) {\n            rendertext = 'Kozak sequence'\n        } else if (rendertext.length > 30) {\n            rendertext = rendertext.slice(0,30) + '...'\n        }\n        ctx.fillText(rendertext, textX, textY)\n\n        triedLocs = [...triedLocs, circleLoc]\n        if (triedLocs.length === maxAnnots){\n            break\n        }\n    }\n}\n\nfunction drawCircleGuide(ctx,locations){\n\n    var radius = locations.circle.radius\n    var origX = locations.circle.origin.x\n    var origY = locations.circle.origin.y\n\n    var transparency = 1 //Math.pow(1/locations.zoom.zoomLevel,0.5)\n\n    var strokeColor = `rgba(64,64,64,${transparency})`\n\n    ctx.beginPath();\n    ctx.arc(origX, origY, radius, 0, 2 * Math.PI, false);\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = strokeColor;\n    ctx.stroke();\n\n}\n\nfunction drawPlasmid(ctx,locations) {\n    var start = Math.floor(((locations.selection.start)/(Math.PI*2))*locations.bases.length)\n    var end = Math.floor(((locations.selection.end)/(Math.PI*2))*locations.bases.length)\n\n    var transparency = 1-Math.pow(1/locations.zoom.zoomLevel,0.5)\n    var strokeColor = `rgba(160,160,160,${transparency})`\n    //a = 'rgb(201,161,92)'\n    var inversion = false\n    if (((locations.selection.start - locations.selection.end > Math.PI) && (locations.selection.start > 1.5*Math.PI)) ||\n            ((locations.selection.start - locations.selection.end < -Math.PI) && (locations.selection.start < 0.5*Math.PI))){\n        var inversion = true\n    }\n    if(inversion === false) {\n        for (var i = start; i < end; i++) {\n\n            var base = locations.bases[i]\n            var base2 = locations.bases[mod(i + 1, locations.bases.length)]\n\n            ctx.beginPath()\n            ctx.arc(base.x, base.y, base.weight * locations.zoom.zoomLevel / 10, 0, 2 * Math.PI, false);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = strokeColor;\n            var fillColor = ''\n            if (base.letter === 'A') {\n                fillColor = `rgba(91,183,248,${transparency})`\n            } else if (base.letter === 'C') {\n                fillColor = `rgba(201,161,92,${transparency})`\n            } else if (base.letter === 'G') {\n                fillColor = `rgba(19,153,23,${transparency})`\n            } else if (base.letter === 'T') {\n                fillColor = `rgba(227,111,111,${transparency})`\n            } else {\n                fillColor = `rgba(255,255,255,${transparency})`\n            }\n            ctx.fillStyle = fillColor\n            ctx.stroke();\n            ctx.font = '24px Arial'\n            ctx.textAlign = 'center'\n            ctx.fillText(base.letter, base.x, base.y + 8)\n        }\n    } else if (start > end) {\n        for (var i = start; i < locations.bases.length + end; i++) {\n\n            var base = locations.bases[mod(i, locations.bases.length)]\n            var base2 = locations.bases[mod(i + 1, locations.bases.length)]\n\n            ctx.beginPath()\n            ctx.arc(base.x, base.y, base.weight * locations.zoom.zoomLevel / 10, 0, 2 * Math.PI, false);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = strokeColor;\n            var fillColor = ''\n            if (base.letter === 'A') {\n                fillColor = `rgba(91,183,248,${transparency})`\n            } else if (base.letter === 'C') {\n                fillColor = `rgba(201,161,92,${transparency})`\n            } else if (base.letter === 'G') {\n                fillColor = `rgba(19,153,23,${transparency})`\n            } else if (base.letter === 'T') {\n                fillColor = `rgba(227,111,111,${transparency})`\n            } else {\n                fillColor = `rgba(255,255,255,${transparency})`\n            }\n            ctx.fillStyle = fillColor\n            ctx.stroke();\n            ctx.font = '24px Arial'\n            ctx.textAlign = 'center'\n            ctx.fillText(base.letter, base.x, base.y + 8)\n        }\n    } else {\n        for (var i = start + locations.bases.length; i > end; i--) {\n            var base = locations.bases[mod(i, locations.bases.length)]\n            var base2 = locations.bases[mod(i + 1, locations.bases.length)]\n\n            ctx.beginPath()\n            ctx.arc(base.x, base.y, base.weight * locations.zoom.zoomLevel / 10, 0, 2 * Math.PI, false);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = strokeColor;\n            var fillColor = ''\n            if (base.letter === 'A') {\n                fillColor = `rgba(91,183,248,${transparency})`\n            } else if (base.letter === 'C') {\n                fillColor = `rgba(201,161,92,${transparency})`\n            } else if (base.letter === 'G') {\n                fillColor = `rgba(19,153,23,${transparency})`\n            } else if (base.letter === 'T') {\n                fillColor = `rgba(227,111,111,${transparency})`\n            } else {\n                fillColor = `rgba(255,255,255,${transparency})`\n            }\n            ctx.fillStyle = fillColor\n            ctx.stroke();\n            ctx.font = '24px Arial'\n            ctx.textAlign = 'center'\n            ctx.fillText(base.letter, base.x, base.y + 8)\n        }\n    }\n}\n\n// LOCATIONS AND FORCES SECTION ======================================================================\nfunction baseForceFromCircle(base, circle, length){\n    var center = getCircleLocation(base.number, length, circle)\n    var newBase = base\n\n    var damper = 3\n    if (Math.abs((center.x - newBase.x)) > 0) {\n        newBase.vx += (Math.pow(Math.abs((center.x - newBase.x)),0.5)*Math.sign(center.x - newBase.x)\n            + (Math.random()-0.5) * 10);\n    }\n\n    if (Math.abs((center.y - newBase.y)) > 0) {\n        newBase.vy += (Math.pow(Math.abs((center.y - newBase.y)),0.5)*Math.sign(center.y - newBase.y)\n            + (Math.random()-0.5) * 10);\n    }\n\n    newBase.vx *= 1/damper;\n    newBase.vy *= 1/damper;\n    newBase.x += newBase.vx\n    newBase.y += newBase.vy\n\n    return newBase\n}\n\nfunction getCircleLocation(baseNumber, basesLength, circle){\n    var increment = Math.PI * 2 / basesLength\n\n    var xval = Math.cos(increment * baseNumber) * (circle.radius + 25) + circle.origin.x\n    var yval = Math.sin(increment * baseNumber) * (circle.radius + 25) + circle.origin.y\n    return {x: xval, y: yval}\n}\n\nfunction zoomBroker(root, trigger, zoomedMax){\n    if ((root.zoom.isZooming === 0) && (trigger === true)){\n        //start zooming\n        root.zoom.zoomDirection *= -1\n        root.zoom.isZooming = 1\n        if (root.scenario === 'fullPlasmid'){\n            if(((root.selection.start - root.selection.end > Math.PI) && (root.selection.start > 1.5*Math.PI)) ||\n                ((root.selection.start - root.selection.end < -Math.PI) && (root.selection.start < 0.5*Math.PI))){\n            root.zoom.zoomCenter = (root.selection.start + root.selection.end)/2 + Math.PI} else {\n            root.zoom.zoomCenter = (root.selection.start + root.selection.end)/2\n            }\n        }\n    } else if ((root.zoom.isZooming === 1) && (\n        ((root.zoom.zoomLevel >= zoomedMax) && (root.zoom.zoomDirection === 1))\n    )){\n        //stop zooming\n        root.zoom.isZooming = 0\n        root.scenario = 'arc'\n    } else if ((root.zoom.isZooming === 1) && (\n        ((root.zoom.zoomLevel <= 1) && (root.zoom.zoomDirection === -1))\n\n    )){\n        root.zoom.isZooming = 0\n        root.scenario = 'fullPlasmid'\n    } else {\n        root.scenario = 'zoom'\n    }\n    return root\n}\n\nfunction zoomCircle(locations, trigger){\n\n    var startenddiff = (locations.selection.end) - (locations.selection.start)\n    if (startenddiff < -Math.PI){\n        startenddiff += Math.PI * 2\n    }\n    else if(((locations.selection.start - locations.selection.end > Math.PI) && (locations.selection.start > 1.5*Math.PI)) ||\n                ((locations.selection.start - locations.selection.end < -Math.PI) && (locations.selection.start < 0.5*Math.PI))){\n        startenddiff = -startenddiff + Math.PI * 2\n    }\n    var maxBasesOnZoom = Math.floor((((startenddiff)/(Math.PI*2))*locations.bases.length))\n    if(maxBasesOnZoom < 10){\n        maxBasesOnZoom = 10\n    }\n    var max = (locations.baseString.length/maxBasesOnZoom)/2\n    var root = zoomBroker(locations, trigger, max)\n    var startZoom = root.zoom.zoomLevel\n    var zoomSpeed = 1.05\n    var factor = Math.pow(zoomSpeed,root.zoom.zoomDirection)\n    var startRadius = root.circle.radius\n    root.circle.radius *= factor\n    root.zoom.zoomLevel *= factor\n    var windowContext = radiusSizer()\n    if (root.circle.radius < windowContext){\n        root.circle.radius = windowContext\n        root.zoom.zoomLevel = 1\n    } else if (root.circle.radius > (windowContext)*max) {\n        root.circle.radius = windowContext*max\n        root.zoom.zoomLevel = max\n    }\n    var adder = 0\n    var adderspeed = 5\n    if(true){\n        adder = root.zoom.zoomDirection * adderspeed\n    }\n    var radiff = root.circle.radius - startRadius + adder\n    var grow = factor\n    var center = root.zoom.zoomCenter + Math.PI\n    root.circle.origin.x += radiff * Math.cos(center)\n    root.circle.origin.y += radiff * Math.sin(center)\n    return root\n}\n\nfunction runPoly(locations, start, end){\n    var root = locations\n    var poly = root.poly\n    var scenario = root.scenario\n    if (poly.target < start){\n        poly.target = start\n        poly.x = -250\n        poly.y = -250\n        scenario = 'poly'\n    }\n    var target = root.bases[poly.target]\n    var diffx = target.x - poly.x\n    var diffy = target.y - poly.y\n    if (Math.abs(diffx+diffy) < 10){\n        root.poly.target += 1\n    } else {\n        poly.x += (diffx)/10\n        poly.y += (diffy)/10\n        if (poly.target > start) {\n            root.bases[poly.target].x -= 10\n            root.bases[poly.target].y -= 10\n            root.bases[poly.target + 1].x -= 7\n            root.bases[poly.target + 1].y -= 7\n            root.bases[poly.target + 2].x -= 4\n            root.bases[poly.target + 2].y -= 4\n        }\n    }\n    if (poly.target > end){\n        poly.target = -1\n        scenario = 'arc'\n    }\n    root = {...root, poly: poly, scenario: scenario}\n    return root\n}\n\nfunction runPointer (locations, mouse){\n    var root = locations\n    var origin = locations.circle.origin\n    var x = mouse.clientX\n    var y = mouse.clientY\n    var ydiff = y - origin.y\n    var xdiff = x - origin.x\n    var r = Math.sqrt(Math.pow(x - origin.x,2) + Math.pow(ydiff,2))\n    var angle = Math.atan2(ydiff,xdiff)\n    if (angle < 0){\n        angle += Math.PI * 2\n    }\n    var endmaxlength = 2*Math.PI/40\n    root.selection.pointer = angle\n    root.selection.mousex = x\n    root.selection.mousey = y\n    return root\n}\n\nfunction brokerMouseDrag(locations, event, direction){\n    var root = locations\n    if(direction == 'down'){\n        root.selection.activated = true\n        root.selection.start = root.selection.pointer\n    } else if (direction == 'up') {\n        root.selection.activated = false\n        root.selection.end = root.selection.pointer\n        if((root.selection.start > root.selection.end) && (root.selection.start - root.selection.end < Math.PI)) {\n            var temp = root.selection.start\n            root.selection.start = root.selection.end\n            root.selection.end = temp\n        }\n        root = zoomCircle(root, true)\n    }\n    if (locations.scenario == 'fullPlasmid'){\n\n    } else {\n        root = dragBases(root)\n    }\n    return root\n}\n\nfunction dragBases(locations){\n    var root = locations\n    return root\n}\n\n// TICKING SECTION ======================================================================\n\nfunction tickPlasmid(locations) {\n    var root = locations\n\n    if (root.zoom.isZooming === 1 ) {\n        root = zoomCircle(root, false)\n    }\n    var newBases = root.bases\n    var inversion = false\n    var radialstart = locations.selection.start\n    var radialend = locations.selection.end\n    if (((radialstart - radialend > Math.PI) && (radialstart > 1.5*Math.PI)) ||\n                ((radialstart - radialend < -Math.PI) && (radialstart < 0.5*Math.PI))){\n        var temp = radialstart\n        radialstart = radialend\n        radialend = temp\n        var inversion = true\n    }\n\n    var start = Math.floor((radialstart/(Math.PI * 2)) * locations.bases.length)\n    var end = Math.floor((radialend/(Math.PI * 2)) * locations.bases.length)\n    // if (start > end) {\n    //     var temp = start\n    //     start = end\n    //     end = temp\n    // }\n    // ((pointer - start > 0) && (pointer - start < Math.PI)) ||\n    //     ((Math.abs(pointer - start) > Math.PI) && (pointer - start < 0))\n\n    if ((root.scenario === 'arc') || (root.scenario === 'zoom') || (root.scenario === 'poly')) {\n        var lowerlimit, upperlimit\n        if (inversion === false){\n            lowerlimit = start\n            upperlimit = end\n        } else {\n            lowerlimit = end\n            upperlimit = start\n        }\n        if(inversion === false) {\n            for (var i = 0; i < root.bases.length; i++) {\n                var forcedBase = {}\n                if ((i >= lowerlimit) && (i <= upperlimit)) {\n                    newBases[i] = baseForceFromCircle(newBases[i], root.circle, root.bases.length)\n                }\n            }\n        } else {\n            for (var i = 0; i < root.bases.length; i++) {\n                var forcedBase = {}\n                if ((i <= lowerlimit) || (i >= upperlimit)) {\n                    newBases[i] = baseForceFromCircle(newBases[i], root.circle, root.bases.length)\n                }\n            }\n        }\n    }\n\n    root = {...root, bases: newBases}\n    var ticker = start\n\n    if (root.scenario === 'poly'){\n        root = runPoly(root, start, end)\n    }\n\n    return root\n}\n\n\n// HANDLER SECTION ======================================================================\n\nfunction Main() {\n    const [locations, setLocations, canvasRef] = usePersistentCanvas();\n\n    // TIMER ---------------------------------------------\n    React.useEffect(() => {\n        var timerID = setInterval(() => tickMaster(), 10);\n\n        return function cleanup() {\n\n        clearInterval(timerID);\n        };\n    })\n\n    function tickMaster() {\n        setLocations(tickPlasmid(locations))\n    }\n\n    // HANDLERS ---------------------------------------------\n\n      function handleCanvasClick(e) {\n\n      }\n\n      function handleDefault() {\n        setLocations(getFullDefault())\n      }\n\n      function handlePoly() {\n        if(locations.scenario === 'arc'){\n            setLocations({...locations, scenario:'poly'})\n        }\n      }\n\n      function handleZoom() {\n        setLocations(zoomCircle(locations, true))\n      }\n\n      function debug() {\n        console.log(locations)\n      }\n\n      function handleSeqChange(e) {\n        var clone = locations\n        clone.bases = updateBases(e.target.value, locations.baseString, locations.bases, locations.circle)\n        setLocations(clone)\n        setLocations({...locations, baseString: e.target.value})\n\n      }\n\n      function handleMouseMove(e) {\n        setLocations(runPointer(locations, e))\n      }\n\n      function handleMouseDown(e){\n        setLocations(brokerMouseDrag(locations, e, 'down'))\n      }\n\n      function handleMouseUp(e){\n        setLocations(brokerMouseDrag(locations, e, 'up'))\n      }\n\n      window.onresize = function() {\n        setLocations({...locations,\n\n          circle: {radius: radiusSizer(), origin:\n              {x:window.innerWidth*0.4, y:window.innerHeight/2}\n            }\n        })\n      }\n      ;\n\n      // RENDER JSX ---------------------------------------------\n\n      return (\n          <div>\n\n        <canvas\n            ref={canvasRef}\n            style = {{\n                width: '100vw',\n                height: '100vh',\n                border: '1px solid black'\n            }}\n            onClick={handleCanvasClick}\n            onMouseMove={handleMouseMove}\n            onMouseDown={handleMouseDown}\n            onMouseUp = {handleMouseUp}\n            display= 'inline-block'\n          />\n\n          <div className=\"controls\">\n            <button onClick={handleDefault}>Default</button>\n            <button onClick={handleZoom}>Zoom</button>\n            <button onClick={handlePoly}>Poly</button>\n            <button onClick={debug}>Debug</button>\n            <input onChange={handleSeqChange}\n            ></input></div>\n        </div>\n    )\n}\n\nReactDOM.render(\n  <Main/>,\n  document.getElementById('root')\n);"],"sourceRoot":""}